function e(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){return e.map((e=>i*Math.sin(t*e+h)))}const t=Math.PI;function a(e,{m:a,e:s,s:n,"θ":i,h:r,"Φ":h,"𝜓":c,"δx":l,"δy":y}){const u=Math.tanh(n*s),o=u<0?Math.sqrt(1-u*u):1,d=u>0?Math.sqrt(1-u*u):1,f=function(e,a,s,n){const i=n-s,r=t/2;let h=Math.atan(-e/a*Math.tan(n-s));i<-r?h+=t:i>r&&(h-=t);return h}(o,d,i,h),m=Math.cos(i),p=Math.sin(i),x=Math.atan(-d*Math.tan(i)/o),k=Math.atan(d/Math.tan(i)*o),v=o*Math.cos(x)*m-d*Math.sin(x)*p,$=d*Math.sin(k)*m+o*Math.cos(k)*p,g=r*o*m,M=r*d*p,q=r*(v*l),b=r*o*p,N=r*d*m,w=r*($*y);return function(e,t,a,s){return e.map((e=>{const n=t*(e+s)-a;return{x:Math.cos(n),y:Math.sin(n)}}))}(e,a,f,c).map((e=>(({x:e,y:t})=>({x:g*e-M*t+q,y:b*e+N*t+w}))(e)))}function s(e,{m:t,e:s,s:n,"θ":i,h:r,"Φ":h,"𝜓":c,"δx":l,"δy":y}){return a(e,{m:t,e:s,s:n,"θ":i,h:1,"Φ":h,"𝜓":0,"δx":l,"δy":y}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return a>0?r*t/a:0}))}const n=Math.PI,i=1,r=i/Math.sqrt(2);function h(e,{m:t,e:a,s:s,"θ":h,h:c,"Φ":u,"𝜓":o,"δx":d,"δy":f}){const m=Math.tanh(s*a),p=m<0?Math.sqrt(1-m*m):1,x=m>0?Math.sqrt(1-m*m):1,k=function(e,t,a,s){const r=a-s,h=()=>{const a=Math.atan(t/e),s=-a+n,i=-a,h=+a-n;switch(!0){case i<=r&&r<=a:return l[0];case h<=r&&r<i:return l[1];case a<r&&r<=s:return l[2];case r<h||r>s:return l[3];default:return l[0]}},c=h(),y=i*Math.cos(-r),u=i*Math.sin(-r),o=c.x3*e,d=c.y3*t,f=c.x4*e,m=c.y4*t,p=(o*m-d*f)/(y*(m-d)-u*(f-o)),x=y*p/e,k=u*p/t,v=c.dx,$=c.dy,g=v*v+$*$,M=x*$-k*v,q=Math.sqrt(i*i*g-M*M)/g,b=+M*$+q*v,N=-M*v+q*$,w=Math.atan(N/b);return b<=0?w-c.φn:w-c.φp}(p,x,h,u),v=Math.cos(h),$=Math.sin(h),g=p*r,M=x*r,q=Math.atan(x/p),b=Math.hypot(g,M),N=Math.abs(b*Math.cos(h+q)),w=Math.abs(b*Math.sin(h+q)),A=Math.abs(b*Math.cos(h-q)),C=Math.abs(b*Math.sin(h-q)),R=Math.max(N,A),E=Math.max(w,C),B=c*p*v,G=c*x*$,F=c*(R*d),D=c*p*$,I=c*x*v,S=c*(E*f);return function(e,t,a,s){return e.map((e=>{const n=t*(e+s)+a;return{x:y(Math.cos(n),-r,+r),y:y(Math.sin(n),-r,+r)}}))}(e,t,k,o).map((e=>(({x:e,y:t})=>({x:B*e-G*t+F,y:D*e+I*t+S}))(e)))}function c(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":c,"δx":l,"δy":y}){return h(e,{m:t,e:a,s:s,"θ":n,h:1,"Φ":r,"𝜓":0,"δx":l,"δy":y}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return 0===a?0:i*t/a}))}const l=[{x3:+r,y3:-r,x4:+r,y4:+r,dx:1,dy:0,"φn":0,"φp":0},{x3:-r,y3:-r,x4:+r,y4:-r,dx:0,dy:-1,"φn":0,"φp":Math.PI},{x3:-r,y3:+r,x4:+r,y4:+r,dx:0,dy:1,"φn":0,"φp":Math.PI},{x3:-r,y3:-r,x4:-r,y4:+r,dx:-1,dy:0,"φn":Math.PI,"φp":Math.PI}];function y(e,t,a){return Math.min(Math.max(e,t),a)}const u=2*Math.PI,o=50*u/360,d=30*u/360,f=320*u/360,m=60*u/360,p=120*u/360,x=220*u/360,k={x:Math.sin(o),y:-Math.cos(o)},v={x:Math.sin(d),y:Math.cos(d)},$={x:-Math.sin(d),y:Math.cos(d)},g={x:-Math.sin(o),y:-Math.cos(o)};function M(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){const y=Math.tanh(s*a),o=y<0?Math.sqrt(1-y*y):1,d=y>0?Math.sqrt(1-y*y):1,M=function(e,t,a,s){const n=function({x:a,y:s}){return{x:e*a,y:t*s}},i=n(k),r=n(v),h=n($),c=n(g),l=(Math.atan2(i.y,i.x)+u)%u,y=(Math.atan2(r.y,r.x)+u)%u,o=(Math.atan2(h.y,h.x)+u)%u,d=(Math.atan2(c.y,c.x)+u)%u,f=(e,t,a)=>{const s=e.x*t.y-t.x*e.y,n=-a.x,i=t.y-e.y,r=e.x-t.x,h=a.y,c=i*-a.x-r*h;return{x:s*n/c,y:-(e.x*t.y-t.x*e.y)*a.y/c}},m=(e,t)=>f(i,r,{x:e,y:t}),p=(e,t)=>f(r,h,{x:e,y:t}),x=(e,t)=>f(h,c,{x:e,y:t}),M=(e,t)=>f(c,i,{x:e,y:t}),q=(s-a+u)%u,b=Math.cos(q),N=Math.sin(q);if(q>=l||q<=y)return Math.asin(m(b,N).y/t);if(q>y&&q<=o)return Math.acos(p(b,N).x/e);if(q>o&&q<=d)return Math.PI-Math.asin(x(b,N).y/t);if(q>d)return-Math.acos(M(b,N).x/e);return 0}(o,d,n,r),q=Math.cos(n),b=Math.sin(n),N=function(e,t,a){return function(e,t,a){const s=Math.cos(a),n=Math.sin(a),i=function({x:a,y:i}){return{x:e*(a*s-i*n),y:t*(a*n+i*s)}},r=i(k),h=i(v),c=i($),l=i(g),y=(e,t,a)=>{const s=e.x*t.y-t.x*e.y,n=-a.x,i=t.y-e.y,r=e.x-t.x,h=a.y,c=i*-a.x-r*h;return{x:s*n/c,y:-(e.x*t.y-t.x*e.y)*a.y/c}},u=(e,t)=>y(r,h,{x:e,y:t}),o=(e,t)=>y(h,c,{x:e,y:t}),d=(e,t)=>y(c,l,{x:e,y:t}),f=(e,t)=>y(l,r,{x:e,y:t}),m=function(...e){let t=1;for(const a of e)!Number.isNaN(a)&&Number.isFinite(a)&&a<t&&a>=0&&(t=a);return t},p=function(...e){let t=-1;for(const a of e)!Number.isNaN(a)&&Number.isFinite(a)&&a>t&&a<=0&&(t=a);return t},x=[u(0,1).y,o(0,1).y,d(0,1).y],M=[o(-1,0).x,d(-1,0).x,f(-1,0).x],q=[u(0,-1).y,d(0,-1).y,f(0,-1).y],b=[u(1,0).x,o(1,0).x,f(1,0).x];return{top:m(...x),left:p(...M),bottom:p(...q),right:m(...b)}}(e,t,a)}(o,d,n),w=Math.abs(c<0?N.right:N.left),A=Math.abs(l<0?N.top:N.bottom),C=i*o*q,R=i*d*b,E=i*(w*c),B=i*o*b,G=i*d*q,F=i*(A*l);return function(e,t,a,s){const n=(e,t,a,s)=>{const n=e.x*t.y-t.x*e.y,i=e.x-t.x,r=a.x*s.y-s.x*a.y,h=a.x-s.x,c=t.y-e.y,l=e.x-t.x,y=s.y-a.y,u=a.x-s.x,o=t.y-e.y,d=e.x*t.y-t.x*e.y,f=s.y-a.y,m=c*u-l*y;return{x:(n*h-i*r)/m,y:(o*(a.x*s.y-s.x*a.y)-d*f)/m}},i=(e,t)=>n(k,v,{x:0,y:t},{x:e,y:t}),r=(e,t)=>n(v,$,{x:e,y:0},{x:e,y:t}),h=(e,t)=>n($,g,{x:0,y:t},{x:e,y:t}),c=(e,t)=>n(g,k,{x:e,y:0},{x:e,y:t});return e.map((e=>{const n=(t*(e+s)+a+u)%u,l=Math.cos(n),y=Math.sin(n);return n>=f||n<=m?i(l,y):n<=p?r(l,y):n<=x?h(l,y):c(l,y)}))}(e,t,M,h).map((e=>(({x:e,y:t})=>({x:C*e-R*t+E,y:B*e+G*t+F}))(e)))}function q(e,t){const a=e.length;if(a!==t.length)throw new RangeError("Mismatched lengths");if(0!=(a&a-1))throw new RangeError("length should be a power of 2");!function(e,t){const a=e.length;if(a!==t.length)throw new RangeError("Mismatched lengths");if(1===a)return;let s=-1;for(let e=0;e<32;e++)1<<e===a&&(s=e);if(-1===s)throw new RangeError("Length is not a power of 2");const n=new Array(a/2),i=new Array(a/2);for(let e=0;e<a/2;e++)n[e]=Math.cos(2*Math.PI*e/a),i[e]=Math.sin(2*Math.PI*e/a);for(let n=0;n<a;n++){const a=r(n,s);if(a>n){let s=e[n];e[n]=e[a],e[a]=s,s=t[n],t[n]=t[a],t[a]=s}}for(let s=2;s<=a;s*=2){const r=s/2,h=a/s;for(let c=0;c<a;c+=s)for(let a=c,s=0;a<c+r;a++,s+=h){const h=a+r,c=e[h]*n[s]+t[h]*i[s],l=-e[h]*i[s]+t[h]*n[s];e[h]=e[a]-c,t[h]=t[a]-l,e[a]+=c,t[a]+=l}}function r(e,t){let a=0;for(let s=0;s<t;s++)a=a<<1|1&e,e>>>=1;return a}}(e,t)}const b=2*Math.PI,N=[...new Array(360)].map(((e,t)=>t*b/360)),w=[...new Array(512)].map(((e,t)=>t*b/512)),A=[...new Array(720)].map(((e,t)=>t*b/720));function C(e){const t=e=>({m:e.m,e:e.e,s:e.s,"θ":G(e.θ),h:e.h,"Φ":G(e.Φ),"𝜓":0,"δx":e.δx,"δy":e.δy}),s=e=>{switch(e.shape){case"ellipse":return a(N,t(e));case"square":return h(N,t(e));case"cowbell":return M(N,t(e));default:return function(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){return e.map((e=>({x:i*Math.cos(t*e),y:i*Math.sin(t*e)})))}(N,t(e))}},n=e.map((e=>s(e))),i=n.reduce(((e,t)=>e.map(((e,a)=>((e,t)=>({x:e.x+t.x,y:e.y+t.y}))(e,t[a])))));return[...n,i]}function R(e){const t=e=>({m:e.m,e:e.e,s:e.s,"θ":G(e.θ),h:e.h,"Φ":G(e.Φ),"𝜓":0,"δx":e.δx,"δy":e.δy}),s=e=>{switch(e.shape){case"ellipse":return function(e,{m:t,e:s,s:n,"θ":i,h:r,"Φ":h,"𝜓":c,"δx":l,"δy":y}){return a(e,{m:t,e:s,s:n,"θ":i,h:1,"Φ":h,"𝜓":0,"δx":l,"δy":y}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return 0===a?0:r*t/a}))}(A,t(e));case"square":return function(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":c,"δx":l,"δy":y}){return h(e,{m:t,e:a,s:s,"θ":n,h:1,"Φ":r,"𝜓":0,"δx":l,"δy":y}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return 0===a?0:i*t/a}))}(A,t(e));case"cowbell":return function(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){return M(e,{m:t,e:a,s:s,"θ":n,h:1,"Φ":r,"𝜓":0,"δx":c,"δy":l}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return 0===a?0:i*t/a}))}(A,t(e));default:return function(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){return e.map((e=>i*Math.sin(t*e)))}(A,t(e))}},n=e.map((e=>s(e))),i=n.reduce(((e,t)=>e.map(((e,a)=>((e,t)=>e+t)(e,t[a])))));return[...n,i]}function E(t,a){const n=e=>({m:e.m,e:e.e,s:e.s,"θ":G(e.θ),h:e.h,"Φ":G(e.Φ),"𝜓":0,"δx":e.δx,"δy":e.δy}),i=(t,a)=>{switch(a.shape){case"ellipse":return s(t,n(a));case"square":return c(t,n(a));case"cowbell":return function(e,{m:t,e:a,s:s,"θ":n,h:i,"Φ":r,"𝜓":h,"δx":c,"δy":l}){return M(e,{m:t,e:a,s:s,"θ":n,h:1,"Φ":r,"𝜓":0,"δx":c,"δy":l}).map((({x:e,y:t})=>{const a=Math.hypot(e,t);return a>0?i*t/a:0}))}(t,n(a));default:return e(t,n(a))}},r=512===a?w:[...new Array(a)].map(((e,t)=>t*b/a));return t.map((e=>i(r,e))).reduce(((e,t)=>e.map(((e,a)=>((e,t)=>e+t)(e,t[a])))))}function B(e){const t=E(e,256),a=4096;let s=new Array(0);const n=new Array(a).fill(0);for(;s.length<a;)s=s.concat(t);return q(s,n),s.slice(0,2048).map(((e,t)=>Math.hypot(e,n[t])/2048))}function G(e){return Math.PI*e/180}const F=Math.PI,D=function(e){return e*F/180};class I{constructor({m:e=1,e:t=0,s:a=10,"θ":s=0,h:n=1,"Φ":i=0,balance:r=0,"𝜓":h=0,"δx":c=0,"δy":l=0,shape:y="ellipse"}={}){this.m=e,this.e=t,this.s=a,this.θ=s,this.h=n,this.Φ=i,this.balance=r,this["𝜓"]=h,this.δx=c,this.δy=l,this.shape=y,this.array=new Float64Array([e,t,a,D(s),n,c,l,D(i),D(h),r,y])}asObject(){return{m:this.m,e:this.e,s:this.s,"θ":this.θ,h:this.h,"δx":this.δx,"δy":this.δy,"Φ":this.Φ,"𝜓":this["𝜓"],balance:this.balance,shape:this.shape}}}const S=0,P=11,O=0,L=1,T=2,j=3,J=4,W=5,Y=6,_=7,U=8,V=9,z=10,H=0,K=1,Q=1;function X(e){const t=[];for(let a=0;a<3;a++){const s=S+a*P,n={shape:ee(e[s+z]),parameters:{m:e[s+O],e:e[s+L],s:e[s+T],"θ":e[s+j],h:e[s+J],"Φ":e[s+_],"𝜓":e[s+U],"δx":e[s+W],"δy":e[s+Y],balance:e[s+V]}};t.push(n)}return t}function Z(e){switch(e){case"ellipse":default:return H;case"square":return K;case"cowbell":return Q}}function ee(e){switch(e){case H:return"ellipse";case K:return"square";case Q:return"cowbell";default:return"ellipse"}}const te={synth:"0.0",oscillator:"0.1",envelope:"0.3",lfo:"0.4",playlist:"0.5"},ae={synth:{settings:{power:"0.1",volume:".0.2",gain:".0.3"},oscillator:".1",R:{m:".2.1.1","ε":".2.1.2","𝗌":".2.1.3","θ":".2.1.4",a:".2.1.5","δx":".2.1.6","δy":".2.1.7","Φ":".2.1.8","𝜓":".2.1.9",b:".2.1.10"},G:{m:".2.2.1","ε":".2.2.2","𝗌":".2.2.3","θ":".2.2.4",a:".2.2.5","δx":".2.2.6","δy":".2.2.7","Φ":"2.2.8","𝜓":".2.2.9",b:".2.2.10"},B:{m:".2.2.1","ε":".2.3.2","𝗌":".2.3.3","θ":".2.3.4",a:".2.3.5","δx":".2.3.6","δy":".2.3.7","Φ":"2.3.8","𝜓":".2.3.9",b:".2.3.10"},envelope:{oid:".3.0",attack:".3.1",decay:".3.2",sustain:".3.3",release:".3.4"},lfo:".4"},oscillator:{multiplier:".1",eccentricity:".2",sensitivity:".3",rotation:".4",amplitude:".5",shiftx:".6",shifty:".7",phase:".8",psi:".9",balance:".10",shape:".11"},envelope:{type:".1",label:".2",description:".3",favourite:".4",inflections:".5",attack:".5.1",decay:".5.2",sustain:".5.3",release:".5.4"},lfo:{on:".1",frequency:".2",range:{min:".3.1",max:".3.2"},plug:".4"},waveform:{trace:{yellow:"0.2.1",red:"0.2.2",green:"0.2.3",blue:"0.2.4"}},playlist:{song:{oid:".0",queueid:".0.0",title:".0.1",file:".0.2",state:".3"},slots:".1",slot:{url:".1",title:".2",state:".3"}}},se={any:/.*/,synth:{any:/^0\.0\..*$/,envelope:/^0\.0\.3.0$/},envelopes:{any:/^0\.3\.[0-9]+\..*$/,label:/^0\.3\.[0-9]+\.2$/,favourite:/^0\.3\.[0-9]+\.4$/,inflections:/^0\.3\.[0-9]+\.5$/},SN:{any:/^0\.1\.[1-6]+\..*$/,OSC:/^0\.1\.[123]+\..*$/,LFO:/^0\.1\.[456]+\..*$/},LFO:{any:/^0\.4\.[1-4]+\..*$/,on:/^0\.4\.[1-4]+\.1$/,frequency:/^0\.4\.[1-4]+\.2$/,range:/^0\.4\.[1-4]+\.3\.[1|2]$/,plug:/^0\.4\.[1-4]+\.4.*$/},playlist:{any:/^0\.5\..*$/,song:{state:/^0\.5\.0\.3$/},slot:{url:/^0\.5\.1\.([1-9]|10|11|12)\.1$/,state:/^0\.5\.1\.([1-9]|10|11|12)\.3$/}}},ne=/^0\.5\.1\.([1-9]|10|11|12)$/,ie=`${te.synth}`,re=`${te.playlist}`,he=`${te.playlist}.0`,ce=`${te.oscillator}.1`,le=`${te.oscillator}.2`,ye=`${te.oscillator}.3`,ue=`${te.oscillator}.4`,oe=`${te.oscillator}.5`,de=`${te.oscillator}.6`,fe=`${te.lfo}.1`,me=`${te.lfo}.2`,pe=`${te.lfo}.3`,xe=`${te.lfo}.4`,ke=`${te.synth}${ae.synth.settings.volume}`,ve=`${te.synth}${ae.synth.settings.gain}`,$e=`${te.synth}${ae.synth.envelope.attack}`,ge=`${te.synth}${ae.synth.envelope.decay}`,Me=`${te.synth}${ae.synth.envelope.sustain}`,qe=`${te.synth}${ae.synth.envelope.release}`,be=`${te.synth}${ae.synth.R.ε}`,Ne=`${te.synth}${ae.synth.G.ε}`,we=`${te.synth}${ae.synth.B.ε}`,Ae=`${te.synth}${ae.synth.R["𝗌"]}`,Ce=`${te.synth}${ae.synth.G["𝗌"]}`,Re=`${te.synth}${ae.synth.B["𝗌"]}`,Ee=`${te.synth}${ae.synth.R.θ}`,Be=`${te.synth}${ae.synth.G.θ}`,Ge=`${te.synth}${ae.synth.B.θ}`,Fe=`${te.synth}${ae.synth.R.a}`,De=`${te.synth}${ae.synth.G.a}`,Ie=`${te.synth}${ae.synth.B.a}`,Se=`${te.synth}${ae.synth.R.δx}`,Pe=`${te.synth}${ae.synth.G.δx}`,Oe=`${te.synth}${ae.synth.B.δx}`,Le=`${te.synth}${ae.synth.R.δy}`,Te=`${te.synth}${ae.synth.G.δy}`,je=`${te.synth}${ae.synth.B.δy}`,Je=`${te.synth}${ae.synth.R.Φ}`,We=`${te.synth}${ae.synth.G.Φ}`,Ye=`${te.synth}${ae.synth.B.Φ}`,_e=`${te.synth}${ae.synth.R["𝜓"]}`,Ue=`${te.synth}${ae.synth.G["𝜓"]}`,Ve=`${te.synth}${ae.synth.B["𝜓"]}`,ze=`${te.synth}${ae.synth.R.b}`,He=`${te.synth}${ae.synth.G.b}`,Ke=`${te.synth}${ae.synth.B.b}`;class Qe{static matches(e,t){return t instanceof RegExp?t.test(e):`${e}`==`${t}`}static contains(e,t){return e===`${t}`||e.startsWith(`${t}.`)}}class Xe extends EventTarget{constructor(){super(),this.change={handlers:new Set,filters:new Map},this.changed={handlers:new Set,filters:new Map},this.addEventListener("change",(e=>{this.onChange(e)})),this.addEventListener("changed",(e=>{this.onChanged(e)}))}subscribe(e,t,a){"change"===e?(this.change.handlers.add(t),null==a?this.change.filters.set(t,se.any):this.change.filters.set(t,a)):"changed"===e?(this.changed.handlers.add(t),null==a?this.changed.filters.set(t,se.any):this.changed.filters.set(t,a)):this.addEventListener(e,t)}unsubscribe(e,t,a){"change"===e?(this.change.handlers.delete(t),this.change.filters.delete(t)):"changed"===e?(this.changed.handlers.delete(t),this.changed.filters.delete(t)):this.removeEventListener(e,t)}onChange(e){this.dispatch(e,this.change.handlers,this.change.filters)}onChanged(e){this.dispatch(e,this.changed.handlers,this.changed.filters)}dispatch(e,t,a){Array.from(t).filter((t=>e.detail.oid.match(a.get(t)))).forEach((t=>t(e)))}}const Ze=new Xe;function et(e,t,a){Ze.subscribe(e,t,a)}function tt(e){Ze.dispatchEvent(e)}class at{constructor(e,t,a,s,n,i){this.type=e,this.oid=t,this.defaults={label:a,text:n,favourite:i,envelope:{}},this.internal={label:s,text:n,favourite:i,onChange:tt,onChanged:tt},this.limits={attack:{min:0,max:1},release:{min:0,max:1}}}get label(){return""!==this.internal.label.trim()?this.internal.label:this.defaults.label}set label(e){this.internal.label=null!=e?`${e}`:"",this.dispatch("changed",ae.envelope.label,this.label)}get text(){return this.internal.text}set text(e){this.internal.text=null!=e?`${e}`:"",this.dispatch("changed",ae.envelope.description,this.text)}get favourite(){return Boolean(this.internal.favourite)}set favourite(e){this.internal.favourite=Boolean(e),this.dispatch("changed",ae.envelope.favourite,this.favourite)}get edited(){return!1}set onChange(e){this.internal.onChange=e}set onChanged(e){this.internal.onChanged=e}dispatch(e,t,a){const s=new CustomEvent(e,{detail:{oid:this.oid+t,value:a}});"change"===e&&this.internal.onChange&&this.internal.onChange(s),"changed"===e&&this.internal.onChange&&this.internal.onChanged(s)}reset(){this.label=this.defaults.label,this.text=this.defaults.text,this.favourite=this.defaults.favourite}serialise(){return{}}deserialise(e){}}class st extends at{static unpack(e){return{type:"AR",attack:e[49],decay:0,sustain:1,release:e[52]}}constructor(e,t,a,s,n,i,r){super("AR",e,t,a,s,r),this.envelope={attack:n,decay:0,sustain:1,release:i},this.defaults.envelope={attack:n,decay:0,sustain:1,release:i}}get edited(){return 0!==this.envelope.attack||0!==this.envelope.release}get attack(){return Number.isNaN(this.envelope.attack)?0:this.envelope.attack}set attack(e){null==e||Number.isNaN(e)||(this.envelope.attack=nt(e,this.limits.attack.min,this.limits.attack.max))}get decay(){return 0}set decay(e){}get sustain(){return 1}set sustain(e){}get release(){return Number.isNaN(this.envelope.release)?0:this.envelope.release}set release(e){null==e||Number.isNaN(e)||(this.envelope.release=nt(e,this.limits.release.min,this.limits.release.max))}reset(){super.reset(),this.attack=this.defaults.envelope.attack,this.release=this.defaults.envelope.release,this.dispatch("changed",ae.envelope.inflections,{attack:this.attack,release:this.release})}clone(){return{type:this.type,attack:this.attack,decay:0,sustain:1,release:this.release}}update(e,t,a,s){"A"===e&&(this.attack=null!=t?t:a,this.dispatch("change",ae.envelope.attack,this.attack)),"R"===e&&(this.release=null!=t?t:a,this.dispatch("change",ae.envelope.release,this.release))}commit(e,t,a,s){"A"===e&&(this.attack=null!=t?t:a,this.dispatch("changed",ae.envelope.attack,this.attack)),"R"===e&&(this.release=null!=t?t:a,this.dispatch("changed",ae.envelope.release,this.release))}inflections(){return{attack:[{tag:"A",value:this.attack,at:this.attack,v:1}],sustain:[],release:[{tag:"R",value:this.release,at:this.release,v:0}]}}pack(e){e[48]=1,e[49]=this.attack,e[50]=0,e[51]=1,e[52]=this.release}serialise(){return{oid:this.oid,type:"AR",label:this.label,text:this.text,favourite:this.favourite,attack:this.attack,release:this.release}}deserialise(e){null!=e&&null!=e.type&&e.type===this.type&&(this.internal.label=null!=e.label?`${e.label}`:"",this.internal.text=null!=e.text?`${e.text}`:"",this.internal.favourite=Boolean(e.favourite),Number.isNaN(e.attack)||(this.envelope.attack=nt(e.attack,0,1)),Number.isNaN(e.release)||(this.envelope.release=nt(e.release,0,1)))}}function nt(e,t,a){return Math.min(Math.max(e,t),a)}class it extends at{static unpack(e){return{type:"ADSR",attack:e[49],decay:e[50],sustain:e[51],release:e[52]}}constructor(e,t,a,s,n,i,r,h,c){super("ADSR",e,t,a,s,c),this.envelope={attack:n,decay:i,sustain:r,release:h},this.defaults.envelope={attack:n,decay:i,sustain:r,release:h}}get edited(){return 0!==this.envelope.attack||0!==this.envelope.decay||1!==this.envelope.sustain||0!==this.envelope.release}get attack(){return Number.isNaN(this.envelope.attack)?0:this.envelope.attack}set attack(e){null==e||Number.isNaN(e)||(this.envelope.attack=rt(e,Math.max(0,this.limits.attack.min-this.decay),this.limits.attack.max-this.decay))}get decay(){return Number.isNaN(this.envelope.decay)?0:this.envelope.decay}set decay(e){null==e||Number.isNaN(e)||(this.envelope.decay=rt(e,Math.max(0,this.limits.attack.min-this.attack),this.limits.attack.max-this.attack))}get sustain(){return Number.isNaN(this.envelope.sustain)?1:this.envelope.sustain}set sustain(e){null==e||Number.isNaN(e)||(this.envelope.sustain=rt(e,0,1))}get release(){return Number.isNaN(this.envelope.release)?0:this.envelope.release}set release(e){null==e||Number.isNaN(e)||(this.envelope.release=rt(e,this.limits.release.min,this.limits.release.max))}reset(){super.reset(),this.attack=this.defaults.envelope.attack,this.decay=this.defaults.envelope.decay,this.sustain=this.defaults.envelope.sustain,this.release=this.defaults.envelope.release,this.dispatch("changed",ae.envelope.inflections,{attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release})}clone(){return{type:this.type,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}update(e,t,a,s){"A"===e&&(this.attack=null!=t?t:a,this.dispatch("change",ae.envelope.attack,this.attack)),"D"===e&&(this.decay=null!=t?t:a-this.attack,this.dispatch("change",ae.envelope.decay,this.decay)),"S"===e&&(this.sustain=null!=t?t:s,this.dispatch("change",ae.envelope.sustain,this.sustain)),"R"===e&&(this.release=null!=t?t:a,this.dispatch("change",ae.envelope.release,this.release))}commit(e,t,a,s){"A"===e&&(this.attack=null!=t?t:a,this.dispatch("changed",ae.envelope.attack,this.attack)),"D"===e&&(this.decay=null!=t?t:a-this.attack,this.dispatch("changed",ae.envelope.decay,this.decay)),"S"===e&&(this.sustain=null!=t?t:s,this.dispatch("changed",ae.envelope.sustain,this.sustain)),"R"===e&&(this.release=null!=t?t:a,this.dispatch("changed",ae.envelope.release,this.release))}inflections(){return{attack:[{tag:"A",value:this.attack,at:this.attack,v:1},{tag:"D",value:this.decay,at:this.attack+this.decay,v:this.sustain}],sustain:[{tag:"S",value:this.sustain,level:this.sustain,start:this.attack+this.decay}],release:[{tag:"R",value:this.release,at:this.release,v:0}]}}pack(e){e[48]=2,e[49]=this.attack,e[50]=this.decay,e[51]=this.sustain,e[52]=this.release}serialise(){return{oid:this.oid,type:"ADSR",label:this.internal.label,text:this.text,favourite:this.favourite,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}deserialise(e){null!=e&&null!=e.type&&e.type===this.type&&(this.internal.label=null!=e.label?`${e.label}`:"",this.internal.text=null!=e.text?`${e.text}`:"",this.internal.favourite=Boolean(e.favourite),Number.isNaN(e.attack)||(this.envelope.attack=rt(e.attack,0,1)),Number.isNaN(e.decay)||(this.envelope.decay=rt(e.decay,0,1)),Number.isNaN(e.sustain)||(this.envelope.sustain=rt(e.sustain,0,1)),Number.isNaN(e.release)||(this.envelope.release=rt(e.release,0,1)))}}function rt(e,t,a){return Math.min(Math.max(e,t),a)}function ht(e,t){const a=JSON.stringify(t);localStorage.setItem(e,a)}function ct(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){console.error(e)}return null}const lt={selected:null};function yt(e){const t=wt.find((t=>t.oid===e));if(null!=t){lt.selected=t.oid;tt(new CustomEvent("changed",{detail:{oid:`${te.synth}${ae.synth.envelope.oid}`,value:t.oid}}))}}function ut(){return null==lt.selected?Nt:ot(lt.selected)}function ot(e){return e.match(/^0.3.[0-9]+$/)?wt.find((t=>t.oid===e)):wt.find((t=>e.startsWith(`${t.oid}.`)))}function dt(e){const t=(wt.findIndex((t=>t.oid===e))+1)%wt.length;return wt[t]}function ft(e,t){const a=wt.find((t=>t.oid===e));null!=a&&(a.favourite=t)}function mt(e){switch(e[$t]){case 1:return st.unpack(e);case 2:return it.unpack(e)}return Nt}function pt(){ht("envelopes",wt.filter((e=>e!==Nt)).map((e=>e.serialise())))}function xt(){try{const e=ct("envelopes");if(null!=e)for(const[t,a]of e.entries())t<12&&a.type&&wt[t].deserialise(a)}catch(e){console.error(e)}}function kt({oid:e,attack:t,decay:a,sustain:s,release:n}){for(const i of wt)i.oid===e&&(i.attack=t,i.decay=a,i.sustain=s,i.release=n,yt(e))}function vt(e){const t=wt.find((t=>t.oid===e));null!=t&&t.reset()}const $t=48,gt=new st(`${te.envelope}.1`,"F","F","Vaguely like a sort of cockney flugelhorn'ish thing",1,.5,!0),Mt=new st(`${te.envelope}.2`,"B","B","Untubular bells",0,.5,!0),qt=new st(`${te.envelope}.3`,"O","O","Ye oldde chyrchhe orgynne",1,1,!0),bt=new it(`${te.envelope}.5`,"O2","O2","Also an organ but more cathedrally",.114,.203,.74,.552,!0),Nt=new st(`${te.envelope}.0`,"","","",.05,.1,!0),wt=[gt,Mt,qt,new st(`${te.envelope}.4`,"4","","",0,0,!1),bt,new it(`${te.envelope}.6`,"6","","",0,0,1,0,!1),new it(`${te.envelope}.7`,"7","","",0,0,1,0,!1),new it(`${te.envelope}.8`,"8","","",0,0,1,0,!1),new it(`${te.envelope}.9`,"9","","",0,0,1,0,!1),new it(`${te.envelope}.10`,"10","","",0,0,1,0,!1),new it(`${te.envelope}.11`,"11","","",0,0,1,0,!1),new it(`${te.envelope}.12`,"12","","",0,0,1,0,!1),Nt],At=[new I({m:1,e:.75,s:10,"θ":30,h:.5,"δx":0,"δy":0,"Φ":0,"𝜓":0,balance:0,shape:"ellipse"}),new I({m:2,e:0,s:10,"θ":0,h:.3,"δx":0,"δy":0,"Φ":0,"𝜓":0,balance:0,shape:"ellipse"}),new I({m:4,e:0,s:10,"θ":0,h:.2,"δx":0,"δy":0,"Φ":0,"𝜓":0,balance:0,shape:"ellipse"})],Ct=Nt,Rt=64*Float64Array.BYTES_PER_ELEMENT;function Et(e,t,a,s,n){const i=new Float64Array(s,n*Rt,64);!function(e,t){for(const[a,s]of e.entries()){const e=S+a*P;t[e+O]=s.m,t[e+L]=s.e,t[e+T]=s.s,t[e+j]=D(s.θ),t[e+J]=s.h,t[e+_]=D(s.Φ),t[e+V]=s.balance,t[e+U]=D(s["𝜓"]),t[e+W]=s.δx,t[e+Y]=s.δy,t[e+z]=Z(s.shape)}}(t,i),function(e,t){if(e&&e.type)switch(e.type){case"AR":case"ADSR":return void e.pack(t)}t[$t]=0}(a,i)}const Bt=new Map([["A0",{key:1,midi:21,frequency:27.5}],["A#0",{key:2,midi:22,frequency:29.135235094881}],["B0",{key:3,midi:23,frequency:30.867706328508}],["C1",{key:4,midi:24,frequency:32.703195662575}],["C#1",{key:5,midi:25,frequency:34.647828872109}],["D1",{key:6,midi:26,frequency:36.708095989676}],["D#1",{key:7,midi:27,frequency:38.89087296526}],["E1",{key:8,midi:28,frequency:41.203444614109}],["F1",{key:9,midi:29,frequency:43.653528929126}],["F#1",{key:10,midi:30,frequency:46.249302838954}],["G1",{key:11,midi:31,frequency:48.999429497719}],["G#1",{key:12,midi:32,frequency:51.913087197493}],["A1",{key:13,midi:33,frequency:55}],["A#1",{key:14,midi:34,frequency:58.270470189761}],["B1",{key:15,midi:35,frequency:61.735412657016}],["C2",{key:16,midi:36,frequency:65.40639132515}],["C#2",{key:17,midi:37,frequency:69.295657744218}],["D2",{key:18,midi:38,frequency:73.416191979352}],["D#2",{key:19,midi:39,frequency:77.78174593052}],["E2",{key:20,midi:40,frequency:82.406889228218}],["F2",{key:21,midi:41,frequency:87.307057858251}],["F#2",{key:22,midi:42,frequency:92.498605677907}],["G2",{key:23,midi:43,frequency:97.998858995437}],["G#2",{key:24,midi:44,frequency:103.826174394986}],["A2",{key:25,midi:45,frequency:110}],["A#2",{key:26,midi:46,frequency:116.540940379523}],["B2",{key:27,midi:47,frequency:123.470825314031}],["C3",{key:28,midi:48,frequency:130.812782650299}],["C#3",{key:29,midi:49,frequency:138.591315488436}],["D3",{key:30,midi:50,frequency:146.832383958704}],["D#3",{key:31,midi:51,frequency:155.563491861041}],["E3",{key:32,midi:52,frequency:164.813778456435}],["F3",{key:33,midi:53,frequency:174.614115716502}],["F#3",{key:34,midi:54,frequency:184.997211355817}],["G3",{key:35,midi:55,frequency:195.997717990875}],["G#3",{key:36,midi:56,frequency:207.652348789973}],["A3",{key:37,midi:57,frequency:220}],["A#3",{key:38,midi:58,frequency:233.081880759045}],["B3",{key:39,midi:59,frequency:246.941650628062}],["C4",{key:40,midi:60,frequency:261.625565300599}],["C#4",{key:41,midi:61,frequency:277.182630976872}],["D4",{key:42,midi:62,frequency:293.664767917408}],["D#4",{key:43,midi:63,frequency:311.126983722081}],["E4",{key:44,midi:64,frequency:329.62755691287}],["F4",{key:45,midi:65,frequency:349.228231433004}],["F#4",{key:46,midi:66,frequency:369.994422711634}],["G4",{key:47,midi:67,frequency:391.995435981749}],["G#4",{key:48,midi:68,frequency:415.304697579945}],["A4",{key:49,midi:69,frequency:440}],["A#4",{key:50,midi:70,frequency:466.16376151809}],["B4",{key:51,midi:71,frequency:493.883301256124}],["C5",{key:52,midi:72,frequency:523.251130601197}],["C#5",{key:53,midi:73,frequency:554.365261953744}],["D5",{key:54,midi:74,frequency:587.329535834815}],["D#5",{key:55,midi:75,frequency:622.253967444162}],["E5",{key:56,midi:76,frequency:659.25511382574}],["F5",{key:57,midi:77,frequency:698.456462866008}],["F#5",{key:58,midi:78,frequency:739.988845423269}],["G5",{key:59,midi:79,frequency:783.990871963499}],["G#5",{key:60,midi:80,frequency:830.60939515989}],["A5",{key:61,midi:81,frequency:880}],["A#5",{key:62,midi:82,frequency:932.32752303618}],["B5",{key:63,midi:83,frequency:987.766602512248}],["C6",{key:64,midi:84,frequency:1046.502261202395}],["C#6",{key:65,midi:85,frequency:1108.730523907488}],["D6",{key:66,midi:86,frequency:1174.65907166963}],["D#6",{key:67,midi:87,frequency:1244.507934888324}],["E6",{key:68,midi:88,frequency:1318.51022765148}],["F6",{key:69,midi:89,frequency:1396.912925732016}],["F#6",{key:70,midi:90,frequency:1479.977690846538}],["G6",{key:71,midi:91,frequency:1567.981743926997}],["G#6",{key:72,midi:92,frequency:1661.218790319781}],["A6",{key:73,midi:93,frequency:1760}],["A#6",{key:74,midi:94,frequency:1864.65504607236}],["B6",{key:75,midi:95,frequency:1975.533205024497}],["C7",{key:76,midi:96,frequency:2093.004522404789}],["C#7",{key:77,midi:97,frequency:2217.461047814977}],["D7",{key:78,midi:98,frequency:2349.318143339261}],["D#7",{key:79,midi:99,frequency:2489.015869776647}],["E7",{key:80,midi:100,frequency:2637.020455302959}],["F7",{key:81,midi:101,frequency:2793.825851464031}],["F#7",{key:82,midi:102,frequency:2959.955381693075}],["G7",{key:83,midi:103,frequency:3135.963487853994}],["G#7",{key:84,midi:104,frequency:3322.437580639561}],["A7",{key:85,midi:105,frequency:3520}],["A#7",{key:86,midi:106,frequency:3729.310092144719}],["B7",{key:87,midi:107,frequency:3951.066410048993}],["C8",{key:88,midi:108,frequency:4186.009044809578}]]);export{fe as $,$e as A,we as B,Ye as C,ge as D,Ve as E,Ke as F,ve as G,Et as H,he as I,ae as J,ne as K,ht as L,ct as M,Bt as N,Qe as O,I as P,tt as Q,qe as R,Me as S,te as T,ce as U,ke as V,le as W,ye as X,ue as Y,oe as Z,de as _,c as a,me as a0,pe as a1,xe as a2,et as a3,C as a4,R as a5,se as a6,B as a7,xt as a8,wt as a9,ft as aa,vt as ab,yt as ac,ot as ad,Nt as ae,pt as af,ie as ag,dt as ah,ut as ai,kt as aj,re as ak,E as al,a as am,h as an,M as ao,Ct as ap,At as aq,X as ar,mt as as,s as b,be as c,Ae as d,Ee as e,Fe as f,Se as g,Le as h,Je as i,_e as j,ze as k,Ne as l,Ce as m,Be as n,De as o,Pe as p,Te as q,We as r,e as s,Ue as t,He as u,Re as v,Ge as w,Ie as x,Oe as y,je as z};
