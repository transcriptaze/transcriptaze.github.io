class t extends HTMLElement{static get observedAttributes(){return["img","tag"]}constructor(){super(),this.internal={tag:""};const t=document.querySelector("#template-pushbutton"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){if("tag"===t&&(this.internal.tag=n),"img"===t){this.shadowRoot.querySelector("img").src=n}}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}set onclick(t){this.shadowRoot.querySelector("button").addEventListener("click",(e=>{t(e)}))}reset(){}}customElements.define("snyth-pushbutton",t);class e extends HTMLElement{static get observedAttributes(){return["tag","states","state","img"]}constructor(){super(),this.internal={tag:"",state:"",states:[],onChanged:null};const t=document.querySelector("#template-pushbutton"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){this.shadowRoot.querySelector("button").onclick=t=>{const e=this.internal.state,n=this.internal.states,a=(n.findIndex((t=>t===e))+1)%n.length;this.state=n[a],null!=this.internal.onChanged&&this.internal.onChanged(this.tag,this.state)}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){if("tag"===t&&(this.internal.tag=`${n}`),"states"===t&&(this.internal.states=n.split("|")),"state"===t&&(this.state=n),"img"===t){this.shadowRoot.querySelector("img").src=n}}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get state(){return this.internal.state}set state(t){this.internal.state=t;for(const e of this.internal.states)e===t?this.classList.add(e):this.classList.remove(e)}set onchanged(t){this.internal.onChanged=t}reset(){}}customElements.define("snyth-togglebutton",e);class n extends HTMLElement{static get observedAttributes(){return["label"]}constructor(){super(),this.internal={label:"A",onChange:null};const t=document.querySelector("#template-checkbox"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("input");t.onchange=e=>{t.checked?this.classList.add("enabled"):this.classList.remove("enabled"),null!=this.internal.onChange&&this.internal.onChange(e)}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"label"===t&&(this.label=n)}get label(){return this.internal.label}set label(t){const e=this.shadowRoot.querySelector("span");this.internal.label=`${t}`,e.innerHTML=this.label}get checked(){return this.shadowRoot.querySelector("input").checked}set onchange(t){this.internal.onChange=t}reset(){}}customElements.define("snyth-checkbox",n);class a extends HTMLElement{static get observedAttributes(){return["oid","href","title"]}constructor(){super(),this.internal={oid:"",href:"",title:"",queued:!1,onPick:null,onPickURL:null,onPlay:null,onQueue:null,onUnqueue:null,onReset:null};const t=document.querySelector("#template-slot"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div");t.oncontextmenu=t=>function(t,e){e.preventDefault(),null!=t.internal.onReset&&t.internal.onReset(e,t.oid)}(this,t),t.onclick=t=>function(t,e){switch(e.stopPropagation(),t.error=!1,!0){case""!==t.url&&!e.altKey&&null!=t.onPlay:t.onPlay(e,t.oid,t.url);break;case""!==t.url&&e.altKey&&t.onQueue&&!t.queued:t.onQueue(e,t.oid);break;case""!==t.url&&e.altKey&&t.onUnqueue&&t.queued:t.onUnqueue(e,t.oid);break;case""===t.url&&null!=t.onPickURL&&e.altKey:t.onPickURL(e,t.oid);break;case""===t.url&&null!=t.onPick:t.onPick(e,t.oid)}return!0}(this,t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("div");"oid"===t&&(this.internal.oid=n),"href"===t&&(this.internal.href=n.trim(),""!==this.url?a.classList.add("enabled"):a.classList.remove("enabled")),"title"===t&&(this.internal.title=n.trim())}get oid(){return this.internal.oid}get url(){const t=this.internal.href;return t&&""!==t?t:""}set url(t){const e=this.shadowRoot.querySelector("div");this.internal.href=t&&""!==t?t:"",""!==this.url?e.classList.add("enabled"):e.classList.remove("enabled")}get title(){const t=this.internal.title;return t&&""!==t?t.trim():""}set title(t){const e=this.shadowRoot.host;t&&(this.internal.title=`${t}`.trim(),e.setAttribute("title",this.title))}get queued(){return this.internal.queued}set queued(t){const e=this.shadowRoot.querySelector("div");this.internal.queued=!0===t,this.queued?e.classList.add("queued"):e.classList.remove("queued")}set error(t){const e=this.shadowRoot.querySelector("div");!0===t?e.classList.add("error"):e.classList.remove("error")}get onPick(){return this.internal.onPick}set onPick(t){this.internal.onPick=t}get onPickURL(){return this.internal.onPickURL}set onPickURL(t){this.internal.onPickURL=t}get onPlay(){return this.internal.onPlay}set onPlay(t){this.internal.onPlay=t}get onQueue(){return this.internal.onQueue}set onQueue(t){this.internal.onQueue=t}get onUnqueue(){return this.internal.onUnqueue}set onUnqueue(t){this.internal.onUnqueue=t}get onReset(){return this.internal.onReset}set onReset(t){this.internal.onReset=t}initialise(t,e){const n=this.shadowRoot.querySelector("div");this.internal.href=t,this.title=e,""!==this.url?n.classList.add("enabled"):n.classList.remove("enabled")}reset(){const t=this.shadowRoot,e=t.host,n=t.querySelector("div");this.internal.href="",this.internal.title="",e.setAttribute("title",""),n.classList.remove("enabled"),n.classList.remove("queued")}}customElements.define("snyth-slot",a);class s extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this.internal={at:50,duration:100};const t=document.querySelector("#template-progressbar"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){this.redraw()}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}get at(){return this.internal.at}set at(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.at=o(e,0,this.duration),this.redraw())}get duration(){return this.internal.duration}set duration(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.duration=o(e,0,900),this.redraw())}reset(){this.at=0}redraw(){const t=this.shadowRoot.querySelector("svg").querySelector(".at"),e=this.at,n=this.duration,a=0===n?0:512*o(e/n,0,1);t.setAttribute("x2",`${a}`)}}function o(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-progressbar",s);const i=t=>Math.sin(t*Math.PI/180),l=t=>Math.cos(t*Math.PI/180);class r extends HTMLElement{static get observedAttributes(){return["label","min","max","step","default","value"]}constructor(){super();const t=document.querySelector("#template-knob"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),this.drag={dragging:!1,startX:0,startY:0,startValue:!1}}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("input");"label"===t&&(this.label=n),"min"===t&&(a.min=n),"max"===t&&(a.max=n),"step"===t&&(a.step=n),"default"===t&&(a.dataset.default=n),"value"===t&&(a.value=n)}get label(){return this.shadowRoot.querySelector("object").contentDocument.getElementsByClassName("label")[0].innerHTML}set label(t){this.shadowRoot.querySelector("object").contentDocument.getElementsByClassName("label")[0].innerHTML=t}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){const e=this.shadowRoot.querySelector("input");e.value=t,e.dispatchEvent(new InputEvent("change")),this.redraw()}set onChange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.value)}))}set onChanged(t){this.shadowRoot.querySelector("input").addEventListener("changed",(()=>{t(this.value)}))}onPointerDown(t,e){const n=t.currentTarget;if(t.preventDefault(),0===t.button)return e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=this.shadowRoot.querySelector("input"),a=t.currentTarget;if(t.preventDefault(),a.onpointermove=null,a.releasePointerCapture(t.pointerId),e.dragging)return e.dragging=!1,n.dispatchEvent(new Event("changed")),!0}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const i=n.clientWidth,l=n.clientHeight,r=(this.max-this.min)*(-(e.startX-t.clientX)/1.5/i+(e.startY-t.clientY)/.75/l);return this.value=(a=e.startValue+r,s=this.min,o=this.max,Math.min(Math.max(a,s),o)),this.redraw(),!0}var a,s,o}get radius(){const t=this.shadowRoot.querySelector("object").contentDocument,e=t.getElementsByClassName("indicator")[0],n=t.getElementsByClassName("indicator-bg")[0];return parseFloat(n.attributes.r.value)-parseFloat(n.attributes["stroke-width"].value)/2-parseFloat(e.attributes["stroke-width"].value)/2}reset(){this.shadowRoot.querySelector("input").value=this.defval,this.redraw()}redraw(){const t=this.shadowRoot.querySelector("object").contentDocument.querySelector(".indicator"),e=this.value,n=this.min,a=(e-n)/(this.max-n),s=this.radius,o=15+330*a,r=s*l(15),c=s*i(15),h=s*l(o),u=-c,d=r,g=-(s*i(o)),f=h;a>.5?t.setAttribute("d",`M${u},${d} A${s},${s},0,0,1,0,${-s} A${s},${s},0,0,1,${g},${f} `):t.setAttribute("d",`M${u},${d} A${s},${s},0,0,1,${g},${f}`)}}customElements.define("snyth-knob",r);const c=t=>Math.sin(t*Math.PI/180),h=t=>Math.cos(t*Math.PI/180);class u extends HTMLElement{static get observedAttributes(){return["tag","label","min","max","step","default","value","m"]}constructor(){super(),this.internal={tag:"",m:1,onChange:null,onChanged:null},this.drag={dragging:!1,startX:0,startY:0,startValue:!1};const t=document.querySelector("#template-knob-s"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e),t.oncontextmenu=t=>this.onReset(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("input");"tag"===t&&(this.tag=n),"label"===t&&(this.label=n),"min"===t&&(a.min=n),"max"===t&&(a.max=n),"step"===t&&(a.step=n),"default"===t&&(a.dataset.default=n),"value"===t&&(a.value=n),"m"===t&&(this.m=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get label(){return this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML}set label(t){this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML=t}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){this.shadowRoot.querySelector("input").value=t,this.redraw()}get m(){return this.internal.m}set m(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.m=e)}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}onReset(t){return t.preventDefault(),this.reset(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}onPointerDown(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey))return t.preventDefault(),e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey)&&(t.preventDefault(),n.onpointermove=null,n.releasePointerCapture(t.pointerId),e.dragging)){e.dragging=!1;const a=n.clientWidth,s=n.clientHeight,o=this.max-this.min,i=this.internal.m*o*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=d(e.startValue+i,this.min,this.max),this.redraw(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const a=n.clientWidth,s=n.clientHeight,o=this.max-this.min,i=this.internal.m*o*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=d(e.startValue+i,this.min,this.max),this.redraw(),this.value!==e.lastValue&&(e.lastValue=this.value,null!=this.internal.onChange&&this.internal.onChange(this)),!0}}get radius(){const t=this.shadowRoot.querySelector("svg"),e=t.getElementsByClassName("indicator")[0],n=t.getElementsByClassName("indicator-bg")[0];return parseFloat(n.attributes.r.value)-parseFloat(n.attributes["stroke-width"].value)/2-parseFloat(e.attributes["stroke-width"].value)/2}reset(){this.value=this.defval}redraw(){const t=this.shadowRoot.querySelector("svg"),e=t.querySelector(".indicator"),n=t.querySelector(".dot"),a=this.value,s=this.min,o=(a-s)/(this.max-s),i=this.radius,l=15+330*o,r=i*h(15),u=i*c(15),d=i*h(l),g=-u,f=r,m=-(i*c(l)),p=d;o>.5?e.setAttribute("d",`M${g},${f} A${i},${i},0,0,1,0,${-i} A${i},${i},0,0,1,${m},${p} `):e.setAttribute("d",`M${g},${f} A${i},${i},0,0,1,${m},${p}`),n.style.transform=`rotate(${l}deg)`}}function d(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-knob-s",u);const g=t=>Math.sin(t*Math.PI/180),f=t=>Math.cos(t*Math.PI/180);class m extends HTMLElement{static get observedAttributes(){return["tag","label","min","max","step","default","value"]}constructor(){super(),this.internal={tag:"",onChange:null,onChanged:null},this.drag={dragging:!1,startX:0,startY:0,startValue:0,lastValue:0};const t=document.querySelector("#template-knob-m"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e),t.oncontextmenu=t=>this.onReset(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("input");"tag"===t&&(this.tag=n),"label"===t&&(this.label=n),"min"===t&&(a.min=n),"max"===t&&(a.max=n),"step"===t&&(a.step=n),"default"===t&&(a.dataset.default=n),"value"===t&&(a.value=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get label(){return this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML}set label(t){this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML=t}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){this.shadowRoot.querySelector("input").value=t,this.redraw()}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}onReset(t){return t.preventDefault(),this.reset(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}onPointerDown(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey))return t.preventDefault(),e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),e.lastValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey)&&(t.preventDefault(),n.onpointermove=null,n.releasePointerCapture(t.pointerId),e.dragging)){e.dragging=!1;const a=n.clientWidth,s=n.clientHeight,o=(this.max-this.min)*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=p(e.startValue+o,this.min,this.max),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const a=n.clientWidth,s=n.clientHeight,o=(this.max-this.min)*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=p(e.startValue+o,this.min,this.max),this.value!==e.lastValue&&(e.lastValue=this.value,null!=this.internal.onChange&&this.internal.onChange(this)),!0}}get radius(){const t=this.shadowRoot.querySelector("svg"),e=t.getElementsByClassName("indicator")[0],n=t.getElementsByClassName("indicator-bg")[0];return parseFloat(n.attributes.r.value)-parseFloat(n.attributes["stroke-width"].value)/2-parseFloat(e.attributes["stroke-width"].value)/2}reset(){this.value=this.defval}redraw(){const t=this.shadowRoot.querySelector("svg"),e=t.querySelector(".indicator"),n=t.querySelector(".dot"),a=this.value,s=this.min,o=(a-s)/(this.max-s),i=this.radius,l=15+330*o,r=i*f(15),c=i*g(15),h=i*f(l),u=-c,d=r,m=-(i*g(l)),p=h;o>.5?e.setAttribute("d",`M${u},${d} A${i},${i},0,0,1,0,${-i} A${i},${i},0,0,1,${m},${p} `):e.setAttribute("d",`M${u},${d} A${i},${i},0,0,1,${m},${p}`),n.style.transform=`rotate(${l}deg)`}}function p(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-knob-m",m);const y=t=>Math.sin(t*Math.PI/180),b=t=>Math.cos(t*Math.PI/180);class v extends HTMLElement{static get observedAttributes(){return["oid","tag","label","min","max","steps","default","value","dot-colour","dot-color"]}constructor(){super(),this.internal={tag:"",oid:"",label:"",min:.1,max:10,steps:20,default:.1,dotColour:"#4eccffff"},this.drag={dragging:!1,startX:0,startY:0,startValue:!1};const t=document.querySelector("#template-lfo-frequency"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot,e=t.querySelector("object"),n=t.querySelector("div.overlay"),a=this.drag;n.onpointerdown=t=>this.onPointerDown(t,a),n.onpointerup=t=>this.onPointerUp(t,a),n.oncontextmenu=t=>this.onReset(t),e.onload=t=>{this.redraw()}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"oid"===t&&(this.oid=n),"tag"===t&&(this.tag=n),"label"===t&&(this.label=n),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"steps"===t&&(this.steps=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n),"dot-colour"!==t&&"dot-color"!==t||(this.dotColour=n)}get oid(){return this.internal.oid}set oid(t){this.internal.oid=t}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get label(){return this.internal.label}set label(t){this.internal.label=t,this.redraw()}get min(){return this.internal.min}set min(t){this.internal.min=parseFloat(t)}get max(){return this.internal.max}set max(t){this.internal.max=parseFloat(t)}get steps(){return this.internal.steps}set steps(t){const e=this.shadowRoot.querySelector("input");"any"===t?e.step="any":(this.internal.steps=parseInt(t),e.step=(e.max-e.min)/this.internal.steps)}get defval(){return this.internal.default}set defval(t){this.internal.default=parseFloat(t)}get value(){const t=this.shadowRoot.querySelector("input"),e=Math.log10(this.min),n=(Math.log10(this.max)-e)/(t.max-t.min),a=e-n*t.min;return Math.pow(10,n*t.value+a)}set value(t){const e=this.shadowRoot.querySelector("input"),n=Math.log10(this.min),a=(Math.log10(this.max)-n)/(e.max-e.min),s=n-a*e.min,o=(Math.log10(t)-s)/a;e.value=o,this.redraw()}get dotColour(){return this.internal.dotColour}set dotColour(t){this.internal.dotColour=t}get dotColor(){return this.internal.gridColour}set dotColor(t){this.internal.gridColour=t}set onchange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.tag,this.value)}))}set onchanged(t){this.shadowRoot.querySelector("input").addEventListener("changed",(()=>{t(this.tag,this.value)}))}onReset(t){return t.preventDefault(),this.reset(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}onPointerDown(t,e){const n=this.shadowRoot.querySelector("input"),a=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey))return t.preventDefault(),e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(n.value),a.classList.add("dragging"),a.onpointermove=t=>this.onPointerMove(t,e),a.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=this.shadowRoot,a=n.querySelector("input"),s=n.querySelector("div.overlay");if(0===t.button&&(!t.ctrlKey||t.altKey)&&(t.preventDefault(),s.onpointermove=null,s.releasePointerCapture(t.pointerId),e.dragging)){e.dragging=!1;const n=s.clientWidth,o=s.clientHeight,i=(this.max-this.min)*(-(e.startX-t.clientX)/2.5/n+(e.startY-t.clientY)/5/o);return a.value=w(e.startValue+i,a.min,a.max),a.dispatchEvent(new InputEvent("changed")),this.redraw(),!0}}onPointerMove(t,e){const n=this.shadowRoot,a=n.querySelector("input"),s=n.querySelector("div.overlay");if(t.preventDefault(),e.dragging){const n=s.clientWidth,o=s.clientHeight,i=(this.max-this.min)*(-(e.startX-t.clientX)/2.5/n+(e.startY-t.clientY)/5/o),l=a.value;return a.value=w(e.startValue+i,a.min,a.max),a.value!==l&&a.dispatchEvent(new InputEvent("change")),this.redraw(),!0}}get radius(){const t=this.shadowRoot.querySelector("object").contentDocument,e=t.getElementsByClassName("indicator")[0],n=t.getElementsByClassName("indicator-bg")[0];return parseFloat(n.attributes.r.value)-parseFloat(n.attributes["stroke-width"].value)/2-parseFloat(e.attributes["stroke-width"].value)/2}reset(){this.value=this.defval}redraw(){try{const t=this.shadowRoot,e=t.querySelector("input"),n=t.querySelector("object").contentDocument,a=n.querySelector(".indicator"),s=n.querySelector(".dot");n.querySelector(".label").innerHTML=this.internal.label;const o=e.value,i=e.min,l=(o-i)/(e.max-i),r=this.radius,c=30,h=c/2+l*(360-c),u=r*b(c/2),d=r*y(c/2),g=r*b(h),f=r*y(h),m=-d,p=+u,v=-f,w=+g;l>.5?a.setAttribute("d",`M${m},${p} A${r},${r},0,0,1,0,${-r} A${r},${r},0,0,1,${v},${w} `):a.setAttribute("d",`M${m},${p} A${r},${r},0,0,1,${v},${w}`),s.style.transform=`rotate(${h}deg)`,s.setAttribute("fill",this.internal.dotColour)}catch(t){}}}function w(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-lfo-frequency",v);class x extends HTMLElement{static get observedAttributes(){return["tag","label","min","max","step","default","value","m"]}constructor(){super(),this.internal={tag:"",m:1,onChange:null,onChanged:null},this.drag={dragging:!1,startX:0,startY:0,startValue:!1};const t=document.querySelector("#template-knob-s"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e),t.oncontextmenu=t=>this.onReset(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("input");"tag"===t&&(this.tag=n),"label"===t&&(this.label=n),"min"===t&&(a.min=n),"max"===t&&(a.max=n),"step"===t&&(a.step=n),"default"===t&&(a.dataset.default=n),"value"===t&&(a.value=n),"m"===t&&(this.m=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get label(){return this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML}set label(t){this.shadowRoot.querySelector("svg").getElementsByClassName("label")[0].innerHTML=t}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){this.shadowRoot.querySelector("input").value=t,this.redraw()}get m(){return this.internal.m}set m(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.m=e)}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}onReset(t){return t.preventDefault(),this.reset(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}onPointerDown(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey))return t.preventDefault(),e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=t.currentTarget;if(0===t.button&&(!t.ctrlKey||t.altKey)&&(t.preventDefault(),n.onpointermove=null,n.releasePointerCapture(t.pointerId),e.dragging)){e.dragging=!1;const a=n.clientWidth,s=n.clientHeight,o=this.max-this.min,i=this.internal.m*o*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=C(e.startValue+i,this.min,this.max),this.redraw(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const a=n.clientWidth,s=n.clientHeight,o=this.max-this.min,i=this.internal.m*o*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=C(e.startValue+i,this.min,this.max),this.redraw(),this.value!==e.lastValue&&(e.lastValue=this.value,null!=this.internal.onChange&&this.internal.onChange(this)),!0}}get radius(){const t=this.shadowRoot.querySelector("svg"),e=t.getElementsByClassName("indicator")[0],n=t.getElementsByClassName("indicator-bg")[0];return parseFloat(n.attributes.r.value)-parseFloat(n.attributes["stroke-width"].value)/2-parseFloat(e.attributes["stroke-width"].value)/2}reset(){this.value=this.defval}redraw(){const t=this.shadowRoot.querySelector("svg"),e=t.querySelector(".indicator"),n=t.querySelector(".dot"),a=this.m*this.value,s=this.min,o=(a-s)/(this.max-s),i=this.radius,l=15+330*o,r=-i,c=-i*(h=l,Math.sin(h*Math.PI/180));var h;const u=i*(t=>Math.cos(t*Math.PI/180))(l);a<0?e.setAttribute("d",`M0,${r} A${i},${i},0,0,0,${c},${u}`):e.setAttribute("d",`M0,${r} A${i},${i},0,0,1,${c},${u}`),n.style.transform=`rotate(${l}deg)`}}function C(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-knob-lr",x);const k=[{shape:"ellipse",image:"./images/ellipse.svg"},{shape:"square",image:"./images/rectangle.svg"},{shape:"cowbell",image:"./images/cowbell.svg"}];class S extends HTMLElement{static get observedAttributes(){return["tag","default","value"]}constructor(){super(),this.internal={tag:"",onChange:null,onChanged:null};const t=document.querySelector("#template-shape"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("button");t.onclick=t=>this.onClick(t),t.oncontextmenu=t=>this.onReset(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){const a=this.shadowRoot.querySelector("input");"tag"===t&&(this.tag=n),"default"===t&&(a.dataset.default=n),"value"===t&&(a.value=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get defval(){return this.shadowRoot.querySelector("input").dataset.default}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){return this.shadowRoot.querySelector("input").value}set value(t){const e=this.shadowRoot,n=e.querySelector("input"),a=e.querySelector("img"),s=k.findIndex((e=>e.shape===t));if(-1!==s){const t=k[s];n.value=t.shape,a.src=t.image}}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}reset(){const t=this.shadowRoot,e=t.querySelector("input"),n=t.querySelector("img"),a=k[0];a&&(e.value=a.shape,n.src=a.image)}onReset(t){return t.preventDefault(),this.reset(),null!=this.internal.onChanged&&this.internal.onChanged(this),!0}onClick(t){if(0===t.button&&(!t.ctrlKey||t.altKey)){t.preventDefault();const e=this.value,n=k.findIndex((t=>t.shape===e)),a=-1===n?0:(n+1)%k.length,s=k[a];this.value=s.shape,null!=this.internal.onChanged&&this.internal.onChanged(this)}}}customElements.define("snyth-shape",S);const q=new Map([["triangle","./images/markers/triangle.svg"],["square","./images/markers/square.svg"],["diamond","./images/markers/diamond.svg"],["circle","./images/markers/circle.svg"]]);class R extends HTMLElement{static get observedAttributes(){return["value","icon","min","max","default"]}constructor(){super(),this.internal={value:Number.NaN,min:0,max:1e3,defval:0,enabled:!1,onChange:null,onChanged:null},this.drag={dragging:!1,start:{x:0,y:0,value:0},last:{x:0,y:0,value:0,timestamp:0}};const t=document.querySelector("#template-range"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay");t.onpointerdown=t=>this.onPointerDown(t),t.onpointerup=t=>this.onPointerUp(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"icon"===t&&q.has(n)&&(this.icon=q.get(n)),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n)}set icon(t){this.shadowRoot.querySelector("img").src=t}get min(){return this.internal.min}set min(t){const e=Number.parseInt(t);e&&!Number.isNaN(e)&&(this.internal.min=e)}get max(){return this.internal.max}set max(t){const e=Number.parseInt(t);e&&!Number.isNaN(e)&&(this.internal.max=e)}get default(){return this.internal.defval}set default(t){const e=Number.parseInt(t);e&&!Number.isNaN(e)&&(this.internal.defval=e)}get value(){return Number.isNaN(this.internal.value)?null:this.internal.value}set value(t){const e=this.shadowRoot.querySelector("input"),n=Number.parseFloat(t);Number.isNaN(n)?this.internal.value=Number.NaN:this.internal.value=Math.round(1e3*n)/1e3,e.value=M`${this.internal.value}`}set enabled(t){this.internal.enabled=t}set onChange(t){this.internal.onChange=t}set onChanged(t){this.internal.onChanged=t}reset(){this.value=this.internal.defval}onPointerDown(t){const e=t.currentTarget,n=this.value;this.internal.enabled&&!Number.isNaN(n)&&0===t.button&&(this.drag.dragging=!0,this.drag.start={x:t.offsetX,y:t.offsetY,value:n},this.drag.last={x:t.offsetX,y:t.offsetY,value:n,timestamp:t.timeStamp},e.onpointermove=t=>this.onPointerMove(t),e.setPointerCapture(t.pointerId))}onPointerUp(t){if(this.drag.dragging){this.drag.dragging=!1;const e=t.currentTarget,n=500*(this.max-this.min),a=2/n,s=.5/n,o=this.drag.last.x,i=this.drag.last.y,l=(o-this.drag.start.x)*a-(i-this.drag.start.y)*s,r=this.drag.start.value+l;this.value=N(r,this.min,this.max),this.internal.onChanged&&this.internal.onChanged(this.value),e.onpointermove=null,e.releasePointerCapture(t.pointerId)}}onPointerMove(t){if(this.drag.dragging){const e=500*(this.max-this.min),n=2/e,a=.5/e,s=t.timeStamp-this.drag.last.timestamp;if(s>0){const e=Math.abs(t.movementX/s),o=Math.abs(t.movementY/s),i=this.drag.last.x+Math.min(2,e/2)*(t.offsetX-this.drag.last.x),l=this.drag.last.y+Math.min(1.5,o/2)*(t.offsetY-this.drag.last.y),r=(i-this.drag.start.x)*n-(l-this.drag.start.y)*a,c=this.drag.start.value+r;this.drag.last.x=i,this.drag.last.y=l,this.drag.last.timestamp=t.timeStamp,this.value=N(c,this.min,this.max),this.internal.onChange&&this.internal.onChange(this.value)}}}}function M(t,e){return Number.isNaN(e)?"":`${Math.round(1e3*e)} ms`}function N(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-range-ms",R);const P=new Map([["triangle","./images/markers/triangle.svg"],["square","./images/markers/square.svg"],["diamond","./images/markers/diamond.svg"],["circle","./images/markers/circle.svg"]]);class E extends HTMLElement{static get observedAttributes(){return["value","icon","min","max","default"]}constructor(){super(),this.internal={value:Number.NaN,min:0,max:1,defval:0,enabled:!1,onChange:null,onChanged:null},this.drag={dragging:!1,start:{x:0,y:0,value:0},last:{x:0,y:0,value:0,timestamp:0}};const t=document.querySelector("#template-range"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay");t.onpointerdown=t=>this.onPointerDown(t),t.onpointerup=t=>this.onPointerUp(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"icon"===t&&P.has(n)&&(this.icon=P.get(n)),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n)}set enabled(t){this.internal.enabled=t}set icon(t){this.shadowRoot.querySelector("img").src=t}get min(){return this.internal.min}set min(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.min=Math.round(100*e)/100)}get max(){return this.internal.max}set max(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.max=Math.round(100*e)/100)}get default(){return this.internal.defval}set default(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.defval=Math.round(100*e)/100)}get value(){return Number.isNaN(this.internal.value)?null:this.internal.value}set value(t){const e=this.shadowRoot.querySelector("input"),n=Number.parseFloat(t);this.internal.value=Number.isNaN(n)?Number.NaN:Math.round(100*T(n,this.min,this.max))/100,e.value=A`${this.internal.value} ms`}set onChange(t){this.internal.onChange=t}set onChanged(t){this.internal.onChanged=t}reset(){this.value=this.internal.defval}onPointerDown(t){const e=t.currentTarget,n=this.value;this.internal.enabled&&!Number.isNaN(n)&&0===t.button&&(this.drag.dragging=!0,this.drag.start={x:t.offsetX,y:t.offsetY,value:n},this.drag.last={x:t.offsetX,y:t.offsetY,value:n,timestamp:t.timeStamp},e.onpointermove=t=>this.onPointerMove(t),e.setPointerCapture(t.pointerId))}onPointerUp(t){if(this.drag.dragging){this.drag.dragging=!1;const e=t.currentTarget,n=500*(this.max-this.min),a=2/n,s=.5/n,o=this.drag.last.x,i=this.drag.last.y,l=(o-this.drag.start.x)*a-(i-this.drag.start.y)*s,r=this.drag.start.value+l;this.value=T(r,this.min,this.max),this.internal.onChanged&&this.internal.onChanged(this.value),e.onpointermove=null,e.releasePointerCapture(t.pointerId)}}onPointerMove(t){if(this.drag.dragging){const e=500*(this.max-this.min),n=2/e,a=.5/e,s=t.timeStamp-this.drag.last.timestamp;if(s>0){const e=Math.abs(t.movementX/s),o=Math.abs(t.movementY/s),i=this.drag.last.x+Math.min(2,e/2)*(t.offsetX-this.drag.last.x),l=this.drag.last.y+Math.min(1.5,o/2)*(t.offsetY-this.drag.last.y),r=(i-this.drag.start.x)*n-(l-this.drag.start.y)*a,c=this.drag.start.value+r;this.drag.last.x=i,this.drag.last.y=l,this.drag.last.timestamp=t.timeStamp,this.value=T(c,this.min,this.max),this.internal.onChange&&this.internal.onChange(this.value)}}}}function A(t,e){return Number.isNaN(e)?"":""+Math.round(100*e)/100}function T(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-range-float",E);class $ extends HTMLElement{static get observedAttributes(){return["tag","min","max","default","value","colour","color"]}constructor(){super(),this.internal={tag:"",value:{min:-1,max:1},min:-1,max:1,defval:0,onChange:null,onChanged:null,colour:"#4eccff80"},this.drag={dragging:!1,marker:"",start:{x:0,y:0,value:0},scale:{m:3.826,c:-262}};const t=document.querySelector("#template-minmax"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay");t.oncontextmenu=t=>function(t,e){e.preventDefault(),t.reset(),null!=t.internal.onChanged&&t.internal.onChanged(this);return!0}(this,t),t.onpointerdown=e=>{(function(t,e){const n=t.shadowRoot,a=n.querySelector("svg"),s=e.currentTarget,o=t.value,i=a.getAttribute("viewBox").split(" ")[3],l=i/s.offsetHeight,r=-i/2,c=function(){const n=s.offsetHeight-e.offsetY,a=s.offsetHeight,i=a*(o.min-t.min)/(t.max-t.min),l=a*(o.max-t.min)/(t.max-t.min),r=Math.abs(n-i),c=Math.abs(n-l);return r<=16&&c<16&&n>l?"max":r<=16&&c<16&&n<i?"min":c<=16?"max":r<=16?"min":""};if(0===e.button){const n=c();if(""!==n)return t.drag.dragging=!0,t.drag.marker=n,t.drag.start={x:e.offsetX,y:e.offsetY,value:{min:o.min,max:o.max}},t.drag.scale={m:l,c:r},!0}return!1})(this,e)&&(t.setPointerCapture(e.pointerId),t.onpointermove=t=>{(function(t,e){const n=e.currentTarget,a=n.offsetHeight;if(t.drag.dragging){const n=-(e.offsetY-t.drag.start.y)/a*(t.max-t.min);switch(t.drag.marker){case"min":return t.value={min:t.drag.start.value.min+n,max:t.drag.start.value.max},!0;case"max":return t.value={min:t.drag.start.value.min,max:t.drag.start.value.max+n},!0}}return!1})(this,t)&&null!=this.internal.onChange&&this.internal.onChange(this.tag,this.value)})},t.onpointerup=t=>{(function(t,e){if(t.drag.dragging)return t.drag.dragging=!1,!0;return!1})(this)&&null!=this.internal.onChanged&&this.internal.onChanged(this.tag,this.value)}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"tag"===t&&(this.tag=n),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n),"colour"!==t&&"color"!==t||(this.colour=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get min(){return this.internal.min}set min(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.min=Math.round(100*e)/100,L(this))}get max(){return this.internal.max}set max(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.max=Math.round(100*e)/100,L(this))}get default(){return this.internal.defval}set default(t){const e=Number.parseFloat(t);e&&!Number.isNaN(e)&&(this.internal.defval=Math.round(100*e)/100)}get value(){return this.internal.value}set value(t){if(t&&!Number.isNaN(t.min)&&!Number.isNaN(t.max)){const e=D(t.min,this.min,this.internal.value.max),n=D(t.max,this.internal.value.min,this.max);this.internal.value={min:Math.min(e,n),max:Math.max(e,n)},L(this)}}get colour(){return this.internal.colour}set colour(t){this.internal.colour=t}get color(){return this.internal.colour}set color(t){this.internal.colour=t}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}reset(){this.value={min:this.min,max:this.max}}}function L(t){try{const e=t.shadowRoot.querySelector("svg"),n=e.getElementById("colour"),a=e.getElementById("extent"),s=e.getElementById("range"),o=e.getElementById("top"),i=e.getElementById("bottom"),l=parseFloat(a.getAttribute("y")),r=-parseFloat(a.getAttribute("height"))/(t.max-t.min),c=l-r,h=r*t.value.min+c,u=r*t.value.max+c,d=Math.min(h,u),g=Math.max(h,u)-d;s.setAttribute("y",`${d}`),s.setAttribute("height",`${g}`),n.setAttribute("stroke",`${t.colour}`),o.setAttribute("transform",`translate(0 ${d+232})`),i.setAttribute("transform",`translate(0 ${d+232+g-464})`)}catch(t){console.log(t)}}function D(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-minmax",$);class F extends HTMLElement{static get observedAttributes(){return["oid"]}constructor(){super(),this.internal={oid:"",scale:1,onChanged:null};const t=document.querySelector("#template-zoom"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot,e=t.querySelector("snyth-pushbutton.plus"),n=t.querySelector("snyth-pushbutton.minus");e.onclick=t=>{this.scale=Y(this.scale*Math.sqrt(2),.25,4)},n.onclick=t=>{this.scale=Y(this.scale/Math.sqrt(2),.25,4)}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"oid"===t&&(this.oid=n)}get oid(){return this.internal.oid}set oid(t){this.internal.oid=t}get scale(){return this.internal.scale}set scale(t){this.internal.scale=t,null!=this.internal.onChanged&&this.internal.onChanged(this.scale)}set onchanged(t){this.internal.onChanged=t}}function Y(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-zoom",F);class I extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this.internal={onPicked:null,onPlaylist:null,onUnqueue:null};const t=document.querySelector("#template-picker"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot,e=t.querySelector("#midi"),n=t.querySelector("#picker img"),a=t.querySelector("#file"),s=t.querySelector("#queued"),o=t.querySelectorAll("snyth-slot");e.ondragover=t=>function(t,e){e.preventDefault();const n=t.shadowRoot,a=n.querySelector("#picker img.clickable");a.classList.add("hover")}(this,t),e.ondragleave=t=>function(t,e){e.preventDefault();const n=t.shadowRoot,a=n.querySelector("#picker img.clickable");a.classList.remove("hover")}(this,t),e.ondrop=t=>function(t,e,n){e.preventDefault();const a=t.shadowRoot,s=a.querySelector("#picker img.clickable");let o=[];s.classList.remove("hover"),e.dataTransfer.files?o=Array.prototype.map.call(e.dataTransfer.files,(t=>t)):e.dataTransfer.items&&(o=Array.prototype.filter.call(e.dataTransfer.items,(t=>"file"===t.kind)).map((t=>t.getAsFile())));o.length>0&&null!=n&&n(o[0],"play")}(this,t,this.onPicked),n.onclick=t=>{a.onchange=t=>H(this,t,this.onPicked),X(this,t)},s.onclick=t=>B(this,t),s.addEventListener("contextmenu",(t=>B(this,t)),!1),o.forEach((t=>{t.onPlay=(t,e,n)=>U(this,e,"play",n),t.onQueue=(t,e,n)=>U(this,e,"queue",n),t.onUnqueue=(t,e)=>U(this,e,"unqueue"),t.onReset=(t,e)=>U(this,e,"reset"),t.onPick=(t,e)=>{a.onchange=t=>H(this,t,(t=>U(this,e,"stash::file",t))),X(this,t)},t.onPickURL=(t,e)=>function(t,e,n){e.stopPropagation();const a=t.shadowRoot,s=a.getElementById("url-picker"),o=a.getElementById("url-picked");s.open?s.close():(s.show(),o.onclick=t=>n(t))}(this,t,(t=>{!function(t,e,n){const a=t.shadowRoot,s=a.getElementById("url-picker"),o=s.querySelector('input[type="url"]'),i=o.value;o.value="",s.close(),""!==i.trim()&&n(i)}(this,0,(t=>{U(this,e,"stash::url",t)}))}))})),window.addEventListener("click",(e=>{const n=t.getElementById("url-picker");n&&n.open&&e.target!==n&&!n.contains(e.target)&&n.close()}))}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}set title(t){this.shadowRoot.querySelector("#title").value=t}set progress(t){this.shadowRoot.querySelector("#progressbar").at=t}set duration(t){this.shadowRoot.querySelector("#progressbar").duration=t}get onPicked(){return this.internal.onPicked}set onPicked(t){this.internal.onPicked=t}get onPlaylist(){return this.internal.onPlaylist}set onPlaylist(t){this.internal.onPlaylist=t}get onUnqueue(){return this.internal.onUnqueue}set onUnqueue(t){this.internal.onUnqueue=t}queued(t,e){const n=this.shadowRoot,a=n.querySelectorAll("snyth-slot"),s=n.querySelector("#queued");for(const n of a)if(n.oid===t)return void(n.queued=!0===e);!0===e?s.classList.add("queued"):s.classList.remove("queued")}stashed(t,e,n){const a=this.shadowRoot.querySelectorAll("snyth-slot");for(const s of a)s.oid===t&&(s.url=e,s.title=n)}error(t){const e=this.shadowRoot.querySelectorAll("snyth-slot");for(const n of e)n.oid===t&&(n.error=!0)}}function X(t,e){const n=t.shadowRoot.getElementById("file"),a=e.altKey;n.value=null,n.dataset.action=a?"queue":"play",n.dataset.oid="",n.click()}function H(t,e,n){const a=t.shadowRoot.getElementById("file"),s=Array.prototype.map.call(e.target.files,(t=>t)),o=a.dataset.action;s.length>0&&null!=n&&n(s[0],o)}function B(t,e){e.preventDefault(),e.stopPropagation(),e.ctrlKey&&null!=t.onUnqueue&&t.onUnqueue(),e.altKey&&null!=t.onUnqueue&&t.onUnqueue()}function U(t,e,n,a){null!=t.onPlaylist&&t.onPlaylist(n,e,a)}customElements.define("snyth-picker",I);class W extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this.internal={onChange:null,onChanged:null};const t=document.querySelector("#template-controls-worklets"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot,e=t.querySelector("input#wavetable"),n=t.querySelector("input#dds"),a=t=>{null!=this.internal.onChanged&&this.internal.onChanged(t)};e.onclick=a,n.onclick=a}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}set onChanged(t){this.internal.onChanged=t}set enabled(t){const e=this.shadowRoot,n=e.querySelector("input#wavetable"),a=e.querySelector("input#dds");n.disabled=!t,a.disabled=!t}get selected(){const t=this.shadowRoot,e=t.querySelector("input#wavetable"),n=t.querySelector("input#dds");return e.checked?e.value:n.checked?n.value:"none"}set selected(t){const e=this.shadowRoot,n=e.querySelector("input#wavetable"),a=e.querySelector("input#dds");t===n.value?n.checked=!0:t===a.value&&(a.checked=!0)}reset(){}}customElements.define("snyth-worklets",W);const V=Math.PI,K=t=>Math.sin(t*Math.PI/180),G=t=>Math.cos(t*Math.PI/180);class O extends HTMLElement{static get observedAttributes(){return["level-width","min","max","step","default","value"]}constructor(){super(),this.internal={loaded:!1,innerRadius:16.75,outerRadius:39,levelWidth:1.5,level:1,dropping:0},this.drag={dragging:!1,startX:0,startY:0,startValue:!1};const t=document.querySelector("#template-controls-knob"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),window.addEventListener("load",(()=>{const{inner:t,outer:e}=j(a);this.internal.innerRadius=t,this.internal.outerRadius=e,this.internal.loaded=!0,this.redraw()}))}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e)}disconnectedCallback(){}adoptedCallback(){try{if(this.internal.loaded){const t=this.shadowRoot,{inner:e,outer:n}=j(t);this.internal.innerRadius=e,this.internal.outerRadius=n}}catch(t){console.error(t)}}attributeChangedCallback(t,e,n){"level-width"===t&&(this.levelWidth=n),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"step"===t&&(this.step=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n)}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){const e=this.shadowRoot.querySelector("input");e.value=t,e.dispatchEvent(new InputEvent("change")),this.redraw()}get level(){return this.internal.level}set level(t){this.internal.level=t,this.redraw("level")}get dropping(){return this.internal.dropping}set dropping(t){this.internal.dropping=t;const e=this.shadowRoot.querySelector("svg").querySelector("#led"),n=Q(1*this.internal.dropping,0,1);e.setAttribute("opacity",`${n}`)}set onChange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.value)}))}set onChanged(t){this.shadowRoot.querySelector("div.overlay").addEventListener("mouseup",(()=>{t(this.value)}))}onPointerDown(t,e){const n=t.currentTarget;if(t.preventDefault(),0===t.button)return e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=this.shadowRoot.querySelector("input"),a=t.currentTarget;if(t.preventDefault(),a.onpointermove=null,a.releasePointerCapture(t.pointerId),e.dragging)return e.dragging=!1,n.dispatchEvent(new Event("changed")),!0}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const a=n.clientWidth,s=n.clientHeight,o=(this.max-this.min)*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=Q(e.startValue+o,this.min,this.max),this.redraw(),!0}}reset(){this.value=this.defval}redraw(t){const e=this.shadowRoot;if(!this.internal.loaded)return;if(null==t||"level"!==t){const t=e.querySelector("svg"),n=t.querySelector(".indicator"),a=t.querySelector(".dot"),s=this.value,o=this.min,i=(s-o)/(this.max-o),l=this.internal.innerRadius,r=30,c=r/2+i*(360-r),h=l*G(r/2),u=l*K(r/2),d=l*G(c),g=-u,f=h,m=-(l*K(c)),p=d;i>.5?n.setAttribute("d",`M${g},${f} A${l},${l},0,0,1,0,${-l} A${l},${l},0,0,1,${m},${p}`):n.setAttribute("d",`M${g},${f} A${l},${l},0,0,1,${m},${p}`),a.style.transform=`rotate(${c}deg)`}const n=e.querySelector("canvas"),a=n.getContext("2d"),s=n.width,o=n.height,i=s/2,l=o/2,r=2.08*(this.internal.outerRadius+this.internal.levelWidth),c=105*V/180,h=435*V/180,u=this.level*this.value*(h-c),d=a.createConicGradient(c,i,l);d.addColorStop(0,"green"),d.addColorStop(165/360,"yellow"),d.addColorStop(.6875,"orange"),d.addColorStop(330/360,"red"),d.addColorStop(1,"red"),a.clearRect(0,0,s,o),a.beginPath(),a.fillStyle="#222222ff",a.ellipse(i,l,r,r,0,0,2*V),a.fill(),a.beginPath(),a.fillStyle=d,a.moveTo(i,l),a.arc(i,l,r,c,c+u),a.fill()}}function j(t){const e=t.querySelector("svg"),n=e.querySelector(".bg"),a=e.getElementsByClassName("indicator")[0],s=e.getElementsByClassName("indicator-bg")[0];return{inner:parseFloat(s.attributes.r.value)-parseFloat(s.attributes["stroke-width"].value)/2-parseFloat(a.attributes["stroke-width"].value)/2,outer:n.getBBox({stroke:!0}).width+1}}function Q(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-volume",O);const z=Math.PI,J=t=>Math.sin(t*Math.PI/180),Z=t=>Math.cos(t*Math.PI/180);class _ extends HTMLElement{static get observedAttributes(){return["level-width","level-scale","min","max","step","default","value"]}constructor(){super(),this.internal={loaded:!1,innerRadius:16.75,outerRadius:39,levelWidth:2,levelScale:1,level:0,clipping:0},this.drag={dragging:!1,startX:0,startY:0,startValue:!1};const t=document.querySelector("#template-controls-knob"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),window.addEventListener("load",(()=>{const{inner:t,outer:e}=tt(a);this.internal.innerRadius=t,this.internal.outerRadius=e,this.internal.loaded=!0,this.redraw()}))}connectedCallback(){const t=this.shadowRoot.querySelector("div.overlay"),e=this.drag;t.onpointerdown=t=>this.onPointerDown(t,e),t.onpointerup=t=>this.onPointerUp(t,e)}disconnectedCallback(){}adoptedCallback(){try{if(this.internal.loaded){const t=this.shadowRoot,{inner:e,outer:n}=tt(t);this.internal.innerRadius=e,this.internal.outerRadius=n}}catch(t){console.error(t)}}attributeChangedCallback(t,e,n){"level-width"===t&&(this.levelWidth=n),"level-scale"===t&&(this.levelScale=n),"min"===t&&(this.min=n),"max"===t&&(this.max=n),"step"===t&&(this.step=n),"default"===t&&(this.defval=n),"value"===t&&(this.value=n)}set levelWidth(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.levelWidth=e)}set levelScale(t){const e=parseFloat(t);Number.isNaN(e)||(this.internal.levelScale=e)}get min(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.min)}set min(t){this.shadowRoot.querySelector("input").min=t}get max(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.max)}set max(t){this.shadowRoot.querySelector("input").max=t}get step(){return this.shadowRoot.querySelector("input").step}set step(t){this.shadowRoot.querySelector("input").step=t}get defval(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.dataset.default)}set defval(t){this.shadowRoot.querySelector("input").dataset.default=t}get value(){const t=this.shadowRoot.querySelector("input");return parseFloat(t.value)}set value(t){const e=this.shadowRoot.querySelector("input");e.value=t,e.dispatchEvent(new InputEvent("change")),this.redraw()}get level(){return this.internal.level}set level(t){this.internal.level=t,this.redraw("level")}get clipping(){return this.internal.clipping}set clipping(t){this.internal.clipping=t;const e=this.shadowRoot.querySelector("svg").querySelector("#led"),n=et(1*this.internal.clipping,0,1);e.setAttribute("opacity",`${n}`)}set onChange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.value)}))}set onChanged(t){this.shadowRoot.querySelector("div.overlay").addEventListener("mouseup",(()=>{t(this.value)}))}onPointerDown(t,e){const n=t.currentTarget;if(t.preventDefault(),0===t.button)return e.dragging=!0,e.startX=t.clientX,e.startY=t.clientY,e.startValue=parseFloat(this.value),n.classList.add("dragging"),n.onpointermove=t=>this.onPointerMove(t,e),n.setPointerCapture(t.pointerId),!0}onPointerUp(t,e){const n=this.shadowRoot.querySelector("input"),a=t.currentTarget;if(t.preventDefault(),a.onpointermove=null,a.releasePointerCapture(t.pointerId),e.dragging)return e.dragging=!1,n.dispatchEvent(new Event("changed")),!0}onPointerMove(t,e){const n=t.currentTarget;if(t.preventDefault(),e.dragging){const a=n.clientWidth,s=n.clientHeight,o=(this.max-this.min)*(-(e.startX-t.clientX)/1.5/a+(e.startY-t.clientY)/.75/s);return this.value=et(e.startValue+o,this.min,this.max),this.redraw(),!0}}reset(){this.value=this.defval}redraw(t){const e=this.shadowRoot;if(!this.internal.loaded)return;if(null==t||"level"!==t){const t=e.querySelector("svg"),n=t.querySelector(".indicator"),a=t.querySelector(".dot"),s=this.value,o=this.min,i=(s-o)/(this.max-o),l=this.internal.innerRadius,r=30,c=r/2+i*(360-r),h=l*Z(r/2),u=l*J(r/2),d=l*Z(c),g=-u,f=h,m=-(l*J(c)),p=d;i>.5?n.setAttribute("d",`M${g},${f} A${l},${l},0,0,1,0,${-l} A${l},${l},0,0,1,${m},${p}`):n.setAttribute("d",`M${g},${f} A${l},${l},0,0,1,${m},${p}`),a.style.transform=`rotate(${c}deg)`}const n=e.querySelector("canvas"),a=n.getContext("2d"),s=n.width,o=n.height,i=s/2,l=o/2,r=2.08*(this.internal.outerRadius+this.internal.levelWidth),c=2*z/3,h=7*z/3,u=this.level*(h-c)*this.internal.levelScale,d=a.createConicGradient(120*z/180,i,l);d.addColorStop(0,"green"),d.addColorStop(150/360,"yellow"),d.addColorStop(.625,"orange"),d.addColorStop(300/360,"red"),d.addColorStop(301/360,"#222222ff"),d.addColorStop(1,"#222222ff"),a.clearRect(0,0,s,o),a.beginPath(),a.fillStyle="#222222ff",a.ellipse(i,l,r,r,0,0,2*z),a.fill(),a.beginPath(),a.fillStyle=d,a.moveTo(i,l),a.arc(i,l,r,c,c+u),a.fill()}}function tt(t){const e=t.querySelector("svg"),n=e.querySelector(".bg"),a=e.getElementsByClassName("indicator")[0],s=e.getElementsByClassName("indicator-bg")[0];return{inner:parseFloat(s.attributes.r.value)-parseFloat(s.attributes["stroke-width"].value)/2-parseFloat(a.attributes["stroke-width"].value)/2,outer:n.getBBox({stroke:!0}).width+1}}function et(t,e,n){return Math.min(Math.max(t,e),n)}customElements.define("snyth-gain",_);const nt="0.3",at={type:".1",label:".2",description:".3",favourite:".4",inflections:".5",attack:".5.1",decay:".5.2",sustain:".5.3",release:".5.4"},st=/.*/;class ot extends EventTarget{constructor(){super(),this.change={handlers:new Set,filters:new Map},this.changed={handlers:new Set,filters:new Map},this.addEventListener("change",(t=>{this.onChange(t)})),this.addEventListener("changed",(t=>{this.onChanged(t)}))}subscribe(t,e,n){"change"===t?(this.change.handlers.add(e),null==n?this.change.filters.set(e,st):this.change.filters.set(e,n)):"changed"===t?(this.changed.handlers.add(e),null==n?this.changed.filters.set(e,st):this.changed.filters.set(e,n)):this.addEventListener(t,e)}unsubscribe(t,e,n){"change"===t?(this.change.handlers.delete(e),this.change.filters.delete(e)):"changed"===t?(this.changed.handlers.delete(e),this.changed.filters.delete(e)):this.removeEventListener(t,e)}onChange(t){this.dispatch(t,this.change.handlers,this.change.filters)}onChanged(t){this.dispatch(t,this.changed.handlers,this.changed.filters)}dispatch(t,e,n){Array.from(e).filter((e=>t.detail.oid.match(n.get(e)))).forEach((e=>e(t)))}}const it=new ot;function lt(t){it.dispatchEvent(t)}class rt{constructor(t,e,n,a,s,o){this.type=t,this.oid=e,this.defaults={label:n,text:s,favourite:o,envelope:{}},this.internal={label:a,text:s,favourite:o,onChange:lt,onChanged:lt},this.limits={attack:{min:0,max:1},release:{min:0,max:1}}}get label(){return""!==this.internal.label.trim()?this.internal.label:this.defaults.label}set label(t){this.internal.label=null!=t?`${t}`:"",this.dispatch("changed",at.label,this.label)}get text(){return this.internal.text}set text(t){this.internal.text=null!=t?`${t}`:"",this.dispatch("changed",at.description,this.text)}get favourite(){return Boolean(this.internal.favourite)}set favourite(t){this.internal.favourite=Boolean(t),this.dispatch("changed",at.favourite,this.favourite)}get edited(){return!1}set onChange(t){this.internal.onChange=t}set onChanged(t){this.internal.onChanged=t}dispatch(t,e,n){const a=new CustomEvent(t,{detail:{oid:this.oid+e,value:n}});"change"===t&&this.internal.onChange&&this.internal.onChange(a),"changed"===t&&this.internal.onChange&&this.internal.onChanged(a)}reset(){this.label=this.defaults.label,this.text=this.defaults.text,this.favourite=this.defaults.favourite}serialise(){return{}}deserialise(t){}}class ct extends rt{static unpack(t){return{type:"AR",attack:t[49],decay:0,sustain:1,release:t[52]}}constructor(t,e,n,a,s,o,i){super("AR",t,e,n,a,i),this.envelope={attack:s,decay:0,sustain:1,release:o},this.defaults.envelope={attack:s,decay:0,sustain:1,release:o}}get edited(){return 0!==this.envelope.attack||0!==this.envelope.release}get attack(){return Number.isNaN(this.envelope.attack)?0:this.envelope.attack}set attack(t){null==t||Number.isNaN(t)||(this.envelope.attack=ht(t,this.limits.attack.min,this.limits.attack.max))}get decay(){return 0}set decay(t){}get sustain(){return 1}set sustain(t){}get release(){return Number.isNaN(this.envelope.release)?0:this.envelope.release}set release(t){null==t||Number.isNaN(t)||(this.envelope.release=ht(t,this.limits.release.min,this.limits.release.max))}reset(){super.reset(),this.attack=this.defaults.envelope.attack,this.release=this.defaults.envelope.release,this.dispatch("changed",at.inflections,{attack:this.attack,release:this.release})}clone(){return{type:this.type,attack:this.attack,decay:0,sustain:1,release:this.release}}update(t,e,n,a){"A"===t&&(this.attack=null!=e?e:n,this.dispatch("change",at.attack,this.attack)),"R"===t&&(this.release=null!=e?e:n,this.dispatch("change",at.release,this.release))}commit(t,e,n,a){"A"===t&&(this.attack=null!=e?e:n,this.dispatch("changed",at.attack,this.attack)),"R"===t&&(this.release=null!=e?e:n,this.dispatch("changed",at.release,this.release))}inflections(){return{attack:[{tag:"A",value:this.attack,at:this.attack,v:1}],sustain:[],release:[{tag:"R",value:this.release,at:this.release,v:0}]}}pack(t){t[48]=1,t[49]=this.attack,t[50]=0,t[51]=1,t[52]=this.release}serialise(){return{oid:this.oid,type:"AR",label:this.label,text:this.text,favourite:this.favourite,attack:this.attack,release:this.release}}deserialise(t){null!=t&&null!=t.type&&t.type===this.type&&(this.internal.label=null!=t.label?`${t.label}`:"",this.internal.text=null!=t.text?`${t.text}`:"",this.internal.favourite=Boolean(t.favourite),Number.isNaN(t.attack)||(this.envelope.attack=ht(t.attack,0,1)),Number.isNaN(t.release)||(this.envelope.release=ht(t.release,0,1)))}}function ht(t,e,n){return Math.min(Math.max(t,e),n)}class ut extends rt{static unpack(t){return{type:"ADSR",attack:t[49],decay:t[50],sustain:t[51],release:t[52]}}constructor(t,e,n,a,s,o,i,l,r){super("ADSR",t,e,n,a,r),this.envelope={attack:s,decay:o,sustain:i,release:l},this.defaults.envelope={attack:s,decay:o,sustain:i,release:l}}get edited(){return 0!==this.envelope.attack||0!==this.envelope.decay||1!==this.envelope.sustain||0!==this.envelope.release}get attack(){return Number.isNaN(this.envelope.attack)?0:this.envelope.attack}set attack(t){null==t||Number.isNaN(t)||(this.envelope.attack=dt(t,Math.max(0,this.limits.attack.min-this.decay),this.limits.attack.max-this.decay))}get decay(){return Number.isNaN(this.envelope.decay)?0:this.envelope.decay}set decay(t){null==t||Number.isNaN(t)||(this.envelope.decay=dt(t,Math.max(0,this.limits.attack.min-this.attack),this.limits.attack.max-this.attack))}get sustain(){return Number.isNaN(this.envelope.sustain)?1:this.envelope.sustain}set sustain(t){null==t||Number.isNaN(t)||(this.envelope.sustain=dt(t,0,1))}get release(){return Number.isNaN(this.envelope.release)?0:this.envelope.release}set release(t){null==t||Number.isNaN(t)||(this.envelope.release=dt(t,this.limits.release.min,this.limits.release.max))}reset(){super.reset(),this.attack=this.defaults.envelope.attack,this.decay=this.defaults.envelope.decay,this.sustain=this.defaults.envelope.sustain,this.release=this.defaults.envelope.release,this.dispatch("changed",at.inflections,{attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release})}clone(){return{type:this.type,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}update(t,e,n,a){"A"===t&&(this.attack=null!=e?e:n,this.dispatch("change",at.attack,this.attack)),"D"===t&&(this.decay=null!=e?e:n-this.attack,this.dispatch("change",at.decay,this.decay)),"S"===t&&(this.sustain=null!=e?e:a,this.dispatch("change",at.sustain,this.sustain)),"R"===t&&(this.release=null!=e?e:n,this.dispatch("change",at.release,this.release))}commit(t,e,n,a){"A"===t&&(this.attack=null!=e?e:n,this.dispatch("changed",at.attack,this.attack)),"D"===t&&(this.decay=null!=e?e:n-this.attack,this.dispatch("changed",at.decay,this.decay)),"S"===t&&(this.sustain=null!=e?e:a,this.dispatch("changed",at.sustain,this.sustain)),"R"===t&&(this.release=null!=e?e:n,this.dispatch("changed",at.release,this.release))}inflections(){return{attack:[{tag:"A",value:this.attack,at:this.attack,v:1},{tag:"D",value:this.decay,at:this.attack+this.decay,v:this.sustain}],sustain:[{tag:"S",value:this.sustain,level:this.sustain,start:this.attack+this.decay}],release:[{tag:"R",value:this.release,at:this.release,v:0}]}}pack(t){t[48]=2,t[49]=this.attack,t[50]=this.decay,t[51]=this.sustain,t[52]=this.release}serialise(){return{oid:this.oid,type:"ADSR",label:this.internal.label,text:this.text,favourite:this.favourite,attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}}deserialise(t){null!=t&&null!=t.type&&t.type===this.type&&(this.internal.label=null!=t.label?`${t.label}`:"",this.internal.text=null!=t.text?`${t.text}`:"",this.internal.favourite=Boolean(t.favourite),Number.isNaN(t.attack)||(this.envelope.attack=dt(t.attack,0,1)),Number.isNaN(t.decay)||(this.envelope.decay=dt(t.decay,0,1)),Number.isNaN(t.sustain)||(this.envelope.sustain=dt(t.sustain,0,1)),Number.isNaN(t.release)||(this.envelope.release=dt(t.release,0,1)))}}function dt(t,e,n){return Math.min(Math.max(t,e),n)}function gt(t){return t.match(/^0.3.[0-9]+$/)?vt.find((e=>e.oid===t)):vt.find((e=>t.startsWith(`${e.oid}.`)))}const ft=new ct(`${nt}.1`,"F","F","Vaguely like a sort of cockney flugelhorn'ish thing",1,.5,!0),mt=new ct(`${nt}.2`,"B","B","Untubular bells",0,.5,!0),pt=new ct(`${nt}.3`,"O","O","Ye oldde chyrchhe orgynne",1,1,!0),yt=new ut(`${nt}.5`,"O2","O2","Also an organ but more cathedrally",.114,.203,.74,.552,!0),bt=new ct(`${nt}.0`,"","","",.05,.1,!0),vt=[ft,mt,pt,new ct(`${nt}.4`,"4","","",0,0,!1),yt,new ut(`${nt}.6`,"6","","",0,0,1,0,!1),new ut(`${nt}.7`,"7","","",0,0,1,0,!1),new ut(`${nt}.8`,"8","","",0,0,1,0,!1),new ut(`${nt}.9`,"9","","",0,0,1,0,!1),new ut(`${nt}.10`,"10","","",0,0,1,0,!1),new ut(`${nt}.11`,"11","","",0,0,1,0,!1),new ut(`${nt}.12`,"12","","",0,0,1,0,!1),bt],wt=new Event("change"),xt=new Event("changed");class Ct extends HTMLElement{static get observedAttributes(){return["tag","envelope","icon"]}constructor(){super();const t=document.querySelector("#template-controls-envelope"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"tag"===t&&(this.tag=n),"envelope"===t&&(this.value=n),"icon"===t&&(this.icon=n)}get disabled(){return this.shadowRoot.querySelector("button").disabled}set disabled(t){this.shadowRoot.querySelector("button").disabled=t}get value(){return this.shadowRoot.querySelector("input").value}set value(t){this.shadowRoot.querySelector("input").value=t}set label(t){this.shadowRoot.querySelector("label").innerHTML=t}set icon(t){this.shadowRoot.querySelector("img.env").src=`./images/envelopes/${t}.svg`}set onChange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.tag,this.value)}))}set onChanged(t){this.shadowRoot.querySelector("input").addEventListener("changed",(()=>{t(this.tag,this.value)}))}set onClick(t){this.addEventListener("click",(e=>{t(e)}))}update(){const t=this.shadowRoot.querySelector("label"),e=gt(this.value);e&&(t.innerHTML=e.label)}reset(){const t=this.shadowRoot,e=t.querySelector("input"),n=t.querySelector("label");e.value="",n.innerHTML="",e.dispatchEvent(wt),e.dispatchEvent(xt)}}customElements.define("snyth-controls-envelope",Ct);class kt extends HTMLElement{static get observedAttributes(){return["auto"]}constructor(){super(),this.internal={mode:0,handler:null};const t=document.querySelector("#template-controls-load"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){this.shadowRoot.querySelector("button").onclick=t=>function(t,e){e.altKey?t.autoLoad=0===t.internal.mode:t.internal.handler&&t.internal.handler(e)}(this,t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"auto"===t&&(this.autoLoad=!0)}get disabled(){return this.shadowRoot.querySelector("button").disabled}set disabled(t){this.shadowRoot.querySelector("button").disabled=t}set highlight(t){t?this.classList.add("highlight"):this.classList.remove("highlight")}get autoLoad(){return 1===this.internal.mode}set autoLoad(t){const e=this.shadowRoot.querySelector("img.dot");this.internal.mode=t?1:0,1===this.internal.mode?e.classList.add("auto"):e.classList.remove("auto")}set onLoad(t){this.internal.handler=t}reset(){}}customElements.define("snyth-controls-load",kt);class St extends HTMLElement{constructor(){super(),this.state={playing:!1,looping:!1,onChanged:null,onPlay:null,onPause:null};const t=document.querySelector("#template-controls-play"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){this.shadowRoot.querySelector("button").addEventListener("click",(t=>{!function(t,e){e.altKey?(t.loop=!t.state.looping,t.state.onChanged&&t.state.onChanged()):(t.playing=!t.state.playing,t.playing&&t.state.onPlay?t.state.onPlay():!t.playing&&t.state.onPause&&t.state.onPause())}(this,t)}))}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}get disabled(){return this.shadowRoot.querySelector("button").disabled}set disabled(t){this.shadowRoot.querySelector("button").disabled=t}get loop(){return this.state.looping}set loop(t){const e=this.shadowRoot.querySelector("img.loop");this.state.looping=t,this.state.looping?e.classList.add("on"):e.classList.remove("on")}get playing(){return this.state.playing}set playing(t){const e=this.shadowRoot.querySelector("img.state");this.state.playing=t,this.state.playing?e.classList.add("playing"):e.classList.remove("playing")}set onChanged(t){this.state.onChanged=t}set onPlay(t){this.state.onPlay=t}set onPause(t){this.state.onPause=t}reset(){}}customElements.define("snyth-play",St);class qt extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this.internal={enabled:!1,recording:!1,title:"snyth",blob:null};const t=document.querySelector("#template-recording"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot,e=t.querySelector("label"),n=t.querySelector("button"),a=t.querySelector("a#download");e.onclick=t=>{!function(t,e){t.enabled&&(t.recording=!t.recording)}(this)},n.onclick=t=>{!function(t,e){null!=t.blob&&async function(t,e,n){if(window.showSaveFilePicker)!async function(t,e){try{const n={suggestedName:e,types:[{description:"OGG audio",accept:{"audio/ogg":[".ogg"]}}]},a=await window.showSaveFilePicker(n),s=await a.createWritable();await s.write(t),await s.close()}catch(t){"AbortError"!==t.name&&console.error(t)}}(e,""===t?"snyth.ogg":`${t}.ogg`);else{const a=URL.createObjectURL(e);n.href=a,n.download=""===t?"snyth.ogg":`${t}.ogg`,n.click(),URL.revokeObjectURL(a)}}(t.title,t.blob,e)}(this,a)}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}get enabled(){return this.internal.enabled}set enabled(t){const e=this.shadowRoot.querySelector("div.record");this.internal.enabled=!!t,this.internal.enabled?e.classList.add("enabled"):e.classList.remove("enabled")}get ready(){return this.internal.enabled&&this.internal.ready}set ready(t){const e=this.shadowRoot.querySelector("div.record");this.internal.ready=t,this.ready?e.classList.add("ready"):e.classList.remove("ready")}get recording(){return this.internal.enabled&&this.internal.recording}set recording(t){const e=this.shadowRoot.querySelector("div.record");this.internal.recording=!(!this.internal.enabled||!t),this.recording?e.classList.add("recording"):e.classList.remove("recording")}get blob(){return this.internal.blob}get title(){return this.internal.title}set recorded({title:t,blob:e}){const n=this.shadowRoot.querySelector("button");this.internal.title=t,this.internal.blob=e,n.disabled=null==e}reset(){}}customElements.define("snyth-recording",qt);const Rt=Math.PI;class Mt extends HTMLElement{static get observedAttributes(){return["tag"]}constructor(){super();const t=document.querySelector("#template-controlset"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),this.internal={tag:"",controls:{eccentricity:a.querySelector('div.controls [tag=""]'),sensitivity:a.querySelector('div.controls [tag=""]'),rotation:a.querySelector('div.controls [tag=""]'),amplitude:a.querySelector('div.controls [tag="a"]'),shiftx:a.querySelector('div.controls [tag="x"]'),shifty:a.querySelector('div.controls [tag="y"]'),phase:a.querySelector('div.controls [tag=""]'),psi:a.querySelector('div.controls [tag=""]'),balance:a.querySelector('div.controls [tag="b"]'),shape:a.querySelector('div.selectors [tag="shape"]'),multiplier:a.querySelector('div.selectors [tag="m"]')}}}connectedCallback(){this.shadowRoot.querySelector("img.icon").oncontextmenu=t=>function(t,e){return e.preventDefault(),Object.values(t.internal.controls).forEach((t=>t.onReset(e))),!0}(this,t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"tag"===t&&(this.tag=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get multiplier(){return Number(this.internal.controls.multiplier.value)}get eccentricity(){return Number(this.internal.controls.eccentricity.value)}get sensitivity(){return Number(this.internal.controls.sensitivity.value)}get rotation(){return Number(this.internal.controls.rotation.value)}get amplitude(){return Number(this.internal.controls.amplitude.value)}get shiftx(){const t=Number(this.internal.controls.shiftx.value);return Math.atan(Rt*t)/Math.atan(Rt)}get shifty(){const t=Number(this.internal.controls.shifty.value);return Math.atan(Rt*t)/Math.atan(Rt)}get phase(){return Number(this.internal.controls.phase.value)}get psi(){return Number(this.internal.controls.psi.value)}get balance(){return Number(this.internal.controls.balance.value)}get shape(){return this.internal.controls.shape.value}set defaults({m:t=1,e:e=0,s:n=10,"":a=0,h:s=1,"":o=0,balance:i=0,"":l=0,"x":r=0,"y":c=0,shape:h="ellipse"}){this.internal.controls.multiplier.setAttribute("default",t),this.internal.controls.eccentricity.setAttribute("default",e),this.internal.controls.sensitivity.setAttribute("default",n),this.internal.controls.rotation.setAttribute("default",a),this.internal.controls.amplitude.setAttribute("default",s),this.internal.controls.shiftx.setAttribute("default",r),this.internal.controls.shifty.setAttribute("default",c),this.internal.controls.phase.setAttribute("default",o),this.internal.controls.psi.setAttribute("default",l),this.internal.controls.balance.setAttribute("default",i),this.internal.controls.shape.setAttribute("default",h)}set values({m:t=1,e:e=0,s:n=10,"":a=0,h:s=1,"":o=0,balance:i=0,"":l=0,"x":r=0,"y":c=0,shape:h="ellipse"}){this.internal.controls.multiplier.value=t,this.internal.controls.eccentricity.value=e,this.internal.controls.sensitivity.value=n,this.internal.controls.rotation.value=a,this.internal.controls.amplitude.value=s,this.internal.controls.shiftx.value=r,this.internal.controls.shifty.value=c,this.internal.controls.phase.value=o,this.internal.controls.psi.value=l,this.internal.controls.balance.value=i,this.internal.controls.shape.value=h}reset(){Object.values(this.internal.controls).forEach((t=>t.reset()))}set onchange(t){Object.values(this.internal.controls).forEach((e=>{e.onchange=e=>{t(this.tag,e.tag,e.value)}}))}set onchanged(t){Object.values(this.internal.controls).forEach((e=>{e.onchanged=e=>{t(this.tag,e.tag,e.value)}}))}set onChange(t){}set onChanged(t){}}customElements.define("snyth-controlset",Mt);const Nt=Math.PI;class Pt extends HTMLElement{static get observedAttributes(){return["grid-colour","grid-color"]}constructor(){super(),this.internal={gridColour:"#ffbf00c0"};const t=document.querySelector("#template-genfn"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"grid-colour"!==t&&"grid-color"!==t||(this.gridColour=n)}get gridColour(){return this.internal.gridColour}set gridColour(t){this.internal.gridColour=t}get gridColor(){return this.internal.gridColour}set gridColor(t){this.internal.gridColour=t}redraw(t,e,n){const a=this.shadowRoot.querySelector("canvas"),s=a.getContext("2d");!function(t,e,n){const a=e.width,s=e.height,o=8,i=10,l=a-2*o,r=s-2*o,c=l/4,h=r/4,u={x:o,y:o},d={x:u.x+l,y:u.y},g={x:d.x,y:u.y+r},f={x:u.x,y:g.y};n.clearRect(0,0,a,s),n.beginPath(),n.strokeStyle=t.gridColour,n.lineWidth=2,n.moveTo(u.x+i,u.y),n.arcTo(d.x,d.y,g.x,g.y,i),n.arcTo(g.x,g.y,f.x,f.y,i),n.arcTo(f.x,f.y,u.x,u.y,i),n.arcTo(u.x,u.y,u.x+i,d.y,i);for(let t=1;t<4;t++){const e=u.y+t*h;n.moveTo(u.x,e),n.lineTo(u.x+l,e)}for(let t=1;t<4;t++){const e=u.x+t*c;n.moveTo(e,u.y),n.lineTo(e,u.y+r)}n.stroke()}(this,a,s),function(t,e){const n=t.width,a=t.height,s=8,o=10,i=n-2*s,l=a-2*s,r={x:s,y:s},c={x:r.x+i,y:r.y},h={x:c.x,y:r.y+l},u={x:r.x,y:h.y};e.beginPath(),e.moveTo(r.x+o,r.y),e.arcTo(c.x,c.y,h.x,h.y,o),e.arcTo(h.x,h.y,u.x,u.y,o),e.arcTo(u.x,u.y,r.x,r.y,o),e.arcTo(r.x,r.y,r.x+o,c.y,o),e.clip()}(a,s);for(const[o,i]of t.entries())Et(a,s,i,e[o],n)}}function Et(t,e,n,a,s){const o=t.width,i=t.height,l=o-16,r=i-16,c=o/2,h=i/2,u=o/2-8,d=s*(l-4)/l,g=s*(r-4)/r,f=function(t){return{x:c+d*u*t.x,y:h-g*u*t.y}};for(const t of a.colours){const a=f(n[0]),s=[...n.slice(1),n.slice(1)[0]];e.beginPath(),e.strokeStyle=t.colour,e.lineWidth=t.width,e.moveTo(a.x,a.y),s.forEach(((t,n)=>{const{x:a,y:s}=f(t);e.lineTo(a,s)})),e.stroke();const o=c+.96*(a.x-c),i=h+.96*(a.y-h);Math.hypot(o-c,i-h)>20&&(e.beginPath(),e.fillStyle=t.colour,e.strokeStyle=t.colour,e.lineWidth=1,e.ellipse(o,i,3,3,0,0,2*Nt),e.fill())}}customElements.define("snyth-genfn",Pt);class At extends HTMLElement{static get observedAttributes(){return["grid-colour","grid-color"]}constructor(){super(),this.internal={gridColour:"#ffbf00c0"};const t=document.querySelector("#template-waveform"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"grid-colour"!==t&&"grid-color"!==t||(this.gridColour=n)}get gridColour(){return this.internal.gridColour}set gridColour(t){this.internal.gridColour=t}get gridColor(){return this.internal.gridColour}set gridColor(t){this.internal.gridColour=t}redraw(t,e,n){const a=this.shadowRoot.querySelector("canvas"),s=a.getContext("2d");let o=a.width-16,i=a.height-16;const l=Math.floor(i/4),r=Math.floor(i/4);o=l*Math.floor(o/l),i=r*Math.floor(i/r),a.width=o+16,a.height=i+16,function(t,e,n){const a=e.width,s=e.height,o=8,i=10;let l=a-2*o,r=s-2*o;const c=Math.floor(r/4),h=Math.floor(r/4);l=c*Math.floor(l/c),r=h*Math.floor(r/h);const u={x:o,y:o},d={x:u.x+l,y:u.y},g={x:d.x,y:u.y+r},f={x:u.x,y:g.y};n.clearRect(0,0,a,s),n.beginPath(),n.strokeStyle=t.gridColour,n.lineWidth=2,n.moveTo(u.x+i,u.y),n.arcTo(d.x,d.y,g.x,g.y,i),n.arcTo(g.x,g.y,f.x,f.y,i),n.arcTo(f.x,f.y,u.x,u.y,i),n.arcTo(u.x,u.y,u.x+i,d.y,i);for(let t=1;t<4;t++)n.moveTo(u.x,u.y+t*h),n.lineTo(u.x+l,u.y+t*h);let m=c;for(;m<l;)n.moveTo(u.x+m,u.y),n.lineTo(u.x+m,u.y+r),m+=c;n.stroke()}(this,a,s),function(t,e){const n=t.width,a=t.height,s=8,o=10;let i=n-2*s,l=a-2*s;const r=Math.floor(l/4),c=Math.floor(l/4);i=r*Math.floor(i/r),l=c*Math.floor(l/c);const h={x:s,y:s},u={x:h.x+i,y:h.y},d={x:u.x,y:h.y+l},g={x:h.x,y:d.y};e.beginPath(),e.moveTo(h.x+o,h.y),e.arcTo(u.x,u.y,d.x,d.y,o),e.arcTo(d.x,d.y,g.x,g.y,o),e.arcTo(g.x,g.y,h.x,h.y,o),e.arcTo(h.x,h.y,h.x+o,u.y,o),e.clip()}(a,s);for(const[o,i]of t.entries())Tt(a,s,i,e[o],n)}}function Tt(t,e,n,a,s){const o=t.width,i=t.height;let l=o-16,r=i-16;const c=Math.floor(r/4),h=Math.floor(r/4);l=c*Math.floor(l/c),r=h*Math.floor(r/h);const u=8,d=8+r/2,g=r/2,f=(l-4)/l,m=s*(r-4)/r;for(const t of a.colours){e.beginPath(),e.strokeStyle=t.colour,e.lineWidth=t.width;const a=n.length,s=n[0],o=l*0,i=g*s;e.moveTo(u+f*o,d-m*i),n.slice(1).forEach(((t,n)=>{const s=l*((n+1)/a),o=g*t;e.lineTo(u+f*s,d-m*o)})),e.lineTo(u+f*l,d-m*i),e.stroke()}}customElements.define("snyth-waveform",At);const $t=8,Lt=10,Dt=4,Ft=1/128;class Yt extends HTMLElement{static get observedAttributes(){return["fs","f0"]}constructor(){super(),this.internal={fs:256,f0:16,fft:null};const t=document.querySelector("#template-fft"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),this.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){"fs"===t&&(this.fs=`${n}`),"f0"===t&&(this.f0=`${n}`)}get fs(){return this.internal.fs}set fs(t){const e=parseFloat(t);!Number.isNaN(e)&&e>0&&(this.internal.fs=e,It(this))}get f0(){return this.internal.f0}set f0(t){const e=parseFloat(t);!Number.isNaN(e)&&e>0&&(this.internal.f0=e,It(this))}get fft(){return this.internal.fft}set fft(t){null!=t&&Array.isArray(t)&&(this.internal.fft=t,It(this))}}function It(t){const e=t.shadowRoot.querySelector("canvas"),n=e.getContext("2d"),a=e.width,s=e.height;let o=a-16,i=s-16;const l=Math.floor(2*i/4),r=Math.floor(i/4);o=l*Math.floor(o/l),i=r*Math.floor(i/r),e.width=o+16,e.height=i+16,n.clearRect(0,0,a,s),function(t,e,n,a){const s=t.width-2*$t,o=t.height-2*$t,i={x:$t,y:$t},l={x:i.x+s,y:i.y},r={x:l.x,y:i.y+o},c={x:i.x,y:r.y},h=a/2,u=[1,2,4,8,16,32,64,128].map((t=>[1.25*h*t,1.5*h*t,1.75*h*t])).flat(),d=[2,4,8,16,32,64,128].map((t=>h*t)),g=o/(Math.log(Dt)-Math.log(Ft)),f=o-g*Math.log(Dt),m=[Dt,1,.25,.0625,.015625,Ft],p=[2,.5,.125,.03125],y=(t,n,a,l)=>{const r=s/8,c=t.map((t=>r*Math.log2(t/h)));e.beginPath(),e.setLineDash(l),e.strokeStyle=n,e.lineWidth=a;for(const t of c)e.moveTo(i.x+t,i.y),e.lineTo(i.x+t,i.y+o);e.stroke()};y(u,"#ffbf00c0",1,[2,2]),y(d,"#ffbf00c0",2,[]);const b=(t,n,a,l)=>{const r=t.map((t=>g*Math.log(t)+f));e.beginPath(),e.setLineDash(l),e.strokeStyle=n,e.lineWidth=a;for(const t of r)e.moveTo(i.x,i.y+o-t),e.lineTo(i.x+s,i.y+o-t);e.stroke()};b(m,"#ffbf00c0",2,[]),b(p,"#ffbf00c0",1,[2,2]),e.beginPath(),e.setLineDash([]),e.strokeStyle="#ffbf00c0",e.lineWidth=2,e.moveTo(i.x+Lt,i.y),e.arcTo(l.x,l.y,r.x,r.y,Lt),e.arcTo(r.x,r.y,c.x,c.y,Lt),e.arcTo(c.x,c.y,i.x,i.y,Lt),e.arcTo(i.x,i.y,i.x+Lt,l.y,Lt),e.stroke()}(e,n,0,t.f0),function(t,e){const n=t.width-2*$t,a=t.height-2*$t,s={x:$t,y:$t},o={x:s.x+n,y:s.y},i={x:o.x,y:s.y+a},l={x:s.x,y:i.y};e.beginPath(),e.moveTo(s.x+Lt,s.y),e.arcTo(o.x,o.y,i.x,i.y,Lt),e.arcTo(i.x,i.y,l.x,l.y,Lt),e.arcTo(l.x,l.y,s.x,s.y,Lt),e.arcTo(s.x,s.y,s.x+Lt,o.y,Lt),e.clip()}(e,n),null!=t.fft&&function(t,e,n,a,s,o){const i=t.width-2*$t,l=t.height-2*$t,r={x:$t,y:$t},c={x:r.x+i,y:r.y},h={x:c.x,y:r.y+l},u={x:r.x,y:h.y},d=a.length,g=s/(2*d),f=1,m=4,p=Math.log2(1*o*g),y=Math.log2(8*o*g),b=n*(m-f)/(y-p),v=n-b*p,w=l/(Math.log(Dt)-Math.log(Ft)),x=l-w*Math.log(Dt),C=t=>function(t,e,n){return e*Math.log2(t)+n}(t*g,b,v),k=t=>function(t,e,n){const a=e*Math.log(t)+n;return Math.max(a,0)}(t,w,x);e.beginPath(),e.strokeStyle="#ffff00",e.lineWidth=2,e.moveTo(u.x,u.y);for(let t=0;t<d;t++)e.lineTo(u.x+C(t),u.y-k(a[t]));e.stroke()}(e,n,l,t.fft,t.fs,t.f0)}customElements.define("snyth-fft",Yt);const Xt=8,Ht={left:64,right:40,top:24,bottom:40,tick:10},Bt=[{h:0,colour:"#ffbf00ff",width:2,dash:[]},{h:1,colour:"#ffbf00ff",width:2,dash:[]},{h:.5,colour:"#ffbf00c0",width:2,dash:[2,4]},{h:.25,colour:"#ffbf00c0",width:1,dash:[2,4]},{h:.75,colour:"#ffbf00c0",width:1,dash:[2,4]}],Ut=[{w:0,colour:"#ffbf00ff",width:2,dash:[]},{w:1,colour:"#ffbf00ff",width:2,dash:[]},{w:.4,colour:"#ffbf00ff",width:2,dash:[3,6]},{w:.6,colour:"#ffbf00ff",width:2,dash:[3,6]},{w:.1,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.2,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.3,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.5,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.7,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.8,colour:"#ffbf00c0",width:1,dash:[2,4]},{w:.9,colour:"#ffbf00c0",width:1,dash:[2,4]}],Wt=[{text:"0.0",colour:"#ffbf00ff",h:0},{text:"1.0",colour:"#ffbf00ff",h:1},{text:"0.5",colour:"#ffbf00c0",h:.5}],Vt=[{text:"O",colour:"#ffbf00ff",w:0},{text:"1000",colour:"#ffbf00ff",w:.4},{text:"R",colour:"#ffbf00ff",w:.6},{text:"1000",colour:"#ffbf00ff",w:1}],Kt={alpha:"ff"},Gt={alpha:"a0"};class Ot extends HTMLElement{constructor(){super(),this.internal={envelope:null},this.listeners=new Map([["change",[]],["changed",[]]]),this.drag={dragging:!1,inflection:null,start:{x:0,y:0},range:{x:0,y:0},origin:{x:0,y:0},icon:null,context:{xscale:1,yscale:1,X:0,"X":600,Y:0,"Y":300}};const t=document.querySelector("#template-env-editor"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s),window.addEventListener("load",(()=>{this.redraw()}))}connectedCallback(){const t=this.shadowRoot.querySelector("canvas.overlay");t.onpointerdown=t=>this.onPointerDown(t),t.onpointerup=t=>this.onPointerUp(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}set onchange(t){this.#t("change",t)}set onchanged(t){this.#t("changed",t)}#t(t,e){this.listeners.has(t)&&this.listeners.get(t).forEach((e=>this.removeEventListener(t,e))),e&&this.addEventListener(t,e),this.listeners.set(t,e?[e]:[])}edit(t){this.internal.envelope=t,this.redraw()}redraw(t){const e=this.shadowRoot,n=e.querySelector("canvas.envelope"),a=e.querySelector("canvas.animation"),s=e.querySelector("canvas.overlay"),o=n.width,i=n.height,l=this.internal.envelope;if("editing"===t)this.redrawOverlay(l,s,o,i,Kt);else{let t=o-2*Xt,e=i-2*Xt;const r=Math.floor(e/4),c=Math.floor(e/4);t=r*Math.floor(t/r),e=c*Math.floor(e/c),n.width=t+2*Xt,n.height=e+2*Xt,a.width=n.width,a.height=n.height,s.width=n.width,s.height=n.height,this.redrawUnderlay(l,n,o,i),this.redrawOverlay(l,s,o,i,Gt)}}animate(t){const e=this.shadowRoot.querySelector("canvas.animation"),n=e.width,a=e.height;let s=n-2*Xt,o=a-2*Xt;const i=Math.floor(o/4),l=Math.floor(o/4);s=i*Math.floor(s/i),o=l*Math.floor(o/l);const r=e.getContext("2d");r.clearRect(0,0,n,a),null!=t&&function(t,e,n,{attack:a,decay:s,sustain:o,release:i},l){const r={x:Xt,y:Xt},c={x:r.x+e,y:r.y},h={x:c.x,y:r.y+n},u={x:r.x,y:h.y},d=u.x+Ht.left,g=u.y-Ht.bottom,f=h.x-Ht.right,m=r.y+Ht.top,p=.4*(f-d),y=m-g;let b=d,v=g;t.beginPath(),t.setLineDash([]),t.strokeStyle=`#ff0000${l.alpha}`,t.lineWidth=4,t.moveTo(b,v),b=d+p*a,v=g+1*y,t.lineTo(b,v),t.stroke(),t.beginPath(),t.setLineDash([]),t.strokeStyle=`#ff0000${l.alpha}`,t.lineWidth=4,t.moveTo(b,v),b+=p*s,v=g+y*o,t.lineTo(b,v),t.stroke(),t.beginPath(),t.strokeStyle=`#00c0c0${l.alpha}`,t.lineWidth=4,t.setLineDash([]),t.moveTo(b,v),b=d+.6*(f-d),v=g+y*o,t.lineTo(b,v),t.stroke(),t.beginPath(),t.strokeStyle=`#ffff00${l.alpha}`,t.lineWidth=4,t.setLineDash([]),t.moveTo(b,v),b+=p*i,v=g+0*y,t.lineTo(b,v),t.stroke()}(r,s,o,t,Gt)}redrawUnderlay(t,e,n,a){let s=n-2*Xt,o=a-2*Xt;const i=Math.floor(o/4),l=Math.floor(o/4);s=i*Math.floor(s/i),o=l*Math.floor(o/l);const r=e.getContext("2d");r.clearRect(0,0,n,a),function(t,e,n){const a={x:Xt,y:Xt},s={x:a.x+e,y:a.y},o={x:s.x,y:a.y+n},i={x:a.x,y:o.y},l=i.x+Ht.left,r=i.y-Ht.bottom,c=o.x-Ht.right,h=a.y+Ht.top,u=function(){const t=document.createElement("canvas"),e=t.getContext("2d");return t.width=32,t.height=32,e.beginPath(),e.strokeStyle="#ffbf00c0",e.setLineDash([2,2]),e.moveTo(0,32),e.lineTo(32,0),e.stroke(),t};t.fillStyle=t.createPattern(u(),"repeat"),t.fillRect(l+.4*(c-l),r,.2*(c-l),h-r),t.fill();for(const e of Bt)t.beginPath(),t.strokeStyle=e.colour,t.lineWidth=e.width,t.setLineDash(e.dash),t.moveTo(l-Ht.tick,r+e.h*(h-r)),t.lineTo(c+Ht.tick,r+e.h*(h-r)),t.stroke();for(const e of Ut)t.beginPath(),t.strokeStyle=e.colour,t.lineWidth=e.width,t.setLineDash(e.dash),t.moveTo(l+e.w*(c-l),r+Ht.tick),t.lineTo(l+e.w*(c-l),h-Ht.tick),t.stroke();t.font="20px sans-serif";for(const e of Vt){const n=t.measureText(e.text);t.fillStyle=e.colour,t.fillText(e.text,l+e.w*(c-l)-n.width/2,r+Ht.tick+n.fontBoundingBoxAscent)}for(const e of Wt){const n=t.measureText(e.text);t.fillStyle=e.colour,t.fillText(e.text,l-Ht.tick-8-n.width,r+e.h*(h-r)+n.actualBoundingBoxAscent/2)}}(r,s,o),t&&jt(r,s,o,t,Gt)}redrawOverlay(t,e,n,a,s){let o=n-2*Xt,i=a-2*Xt;const l=Math.floor(i/4),r=Math.floor(i/4);o=l*Math.floor(o/l),i=r*Math.floor(i/r);e.getContext("2d").clearRect(0,0,n,a),t&&jt(e.getContext("2d"),o,i,t,s)}onPointerDown(t){const e=this.internal.envelope;if(0===t.button&&e){const n=t.currentTarget;!function(t,e,n,a){e.preventDefault();const s=t.width,o=t.height;let i=s-2*Xt,l=o-2*Xt;const r=Math.floor(l/4),c=Math.floor(l/4);i=r*Math.floor(i/r),l=c*Math.floor(l/c);const h={x:Xt,y:Xt},u={x:[h.x+i,h.y][0],y:h.y+l},d={x:h.x,y:u.y},g=d.x+Ht.left,f=d.y-Ht.bottom,m=u.x-Ht.right,p=h.y+Ht.top,y=.4*(m-g),b=p-f,v=function(t,n,s){a.dragging=!0,a.origin=t,a.start={x:e.offsetX,y:e.offsetY},a.inflection=n,a.icon=s,a.context.xscale=y,a.context.yscale=b,a.context.X=g,a.context.X=m,a.context.Y=f,a.context.Y=p},w=n.inflections();for(const a of w.attack){const s=g+y*a.at,o=f+b*a.v,r=t.width/600*e.offsetX-s,c=t.height/308*e.offsetY-o;if(Math.hypot(r,c)<16)return v({x:g,y:f},a,Qt),jt(t.getContext("2d"),i,l,n,Kt),!0}for(const a of w.sustain){const s=g+y*a.start,o=f+b*a.level,r=t.width/600*e.offsetX-s,c=g+.6*(m-g)-t.width/600*e.offsetX,h=t.height/308*e.offsetY-o;if(r>=0&&c>=0&&h<16)return v({x:g,y:f},a,Zt),jt(t.getContext("2d"),i,l,n,Kt),!0}for(const a of w.release){const s=g+.6*(m-g)+y*a.at,o=f+b*a.v,r=t.width/600*e.offsetX-s,c=t.height/308*e.offsetY-o;if(Math.hypot(r,c)<16)return v({x:g+.6*(m-g),y:p},a,Jt),jt(t.getContext("2d"),i,l,n,Kt),!0}}(n,t,e,this.drag),this.drag.dragging&&(n.onpointermove=t=>function(t,e,n,a){const s=a.inflection,o=e.currentTarget,i=a.context.xscale,l=a.context.yscale,r=a.origin.x,c=a.context.Y,h=r+i*s.at,u=o.width/600*(e.offsetX-a.start.x),d=(h+u-r)/i,g=c+l*s.level,f=o.height/308*(e.offsetY-a.start.y),m=(g+f-c)/l,p=new CustomEvent("change",{detail:{tag:a.inflection.tag,at:d,level:m}});t.dispatchEvent(p)}(this,t,0,this.drag),n.setPointerCapture(t.pointerId))}}onPointerUp(t){const e=t.currentTarget;e.onpointermove=null,e.releasePointerCapture(t.pointerId),this.drag.dragging&&(!function(t,e,n){n.dragging=!1;const a=n.inflection,s=e.currentTarget,o=n.context.xscale,i=n.context.yscale,l=n.origin.x,r=n.context.Y,c=l+o*a.at,h=s.width/600*(e.offsetX-n.start.x),u=(c+h-l)/o,d=r+i*a.level,g=s.height/308*(e.offsetY-n.start.y),f=(d+g-r)/i,m=new CustomEvent("changed",{detail:{tag:n.inflection.tag,at:u,level:f}});t.dispatchEvent(m)}(this,t,this.drag),this.redraw())}}function jt(t,e,n,a,s){const o=Xt,i={x:{x:Xt+e,y:o}.x,y:o+n},l=i.y,r=Xt+Ht.left,c=l-Ht.bottom,h=i.x-Ht.right,u=.4*(h-r),d=o+Ht.top-c;let g=r,f=c;const m=a.inflections();t.beginPath(),t.setLineDash([]),t.strokeStyle=`#ff0000${s.alpha}`,t.lineWidth=4,t.moveTo(g,f);for(const e of m.attack)g=r+u*e.at,f=c+d*e.v,t.lineTo(g,f);t.stroke(),t.beginPath(),t.strokeStyle=`#00c0c0${s.alpha}`,t.lineWidth=4,t.setLineDash([]),t.moveTo(g,f),g=r+.6*(h-r),t.lineTo(g,f),t.stroke(),t.beginPath(),t.strokeStyle=`#ffff00${s.alpha}`,t.lineWidth=4,t.setLineDash([]),t.moveTo(g,f);for(const e of m.release)g+=u*e.at,f=c+d*e.v,t.lineTo(g,f);t.stroke();for(const e of m.attack)g=r+u*e.at,f=c+d*e.v,"A"===e.tag?Qt(t,g,f,s):"D"===e.tag?zt(t,g,f,s):Qt(t,g,f,s);for(const e of m.release)g=r+.6*(h-r)+u*e.at,f=c+d*e.v,e.tag,Jt(t,g,f,s)}function Qt(t,e,n,a){t.beginPath(),t.fillStyle=`#ff0000${a.alpha}`,t.moveTo(e,n-12),t.lineTo(e-12,n+12),t.lineTo(e+12,n+12),t.fill()}function zt(t,e,n,a){t.beginPath(),t.fillStyle=`#e000e0${a.alpha}`,t.moveTo(e-12,n-12),t.lineTo(e+12,n-12),t.lineTo(e+12,n+12),t.lineTo(e-12,n+12),t.fill()}function Jt(t,e,n,a){t.beginPath(),t.fillStyle=`#ffff00${a.alpha}`,t.moveTo(e,n-12),t.lineTo(e+12,n),t.lineTo(e,n+12),t.lineTo(e-12,n),t.fill()}function Zt(t,e,n,a){t.beginPath(),t.fillStyle=`#00c0c0${a.alpha}`,t.circle(e,n,12),t.fill()}customElements.define("snyth-envelope-editor",Ot);class _t extends HTMLElement{static get observedAttributes(){return["tag","envelope","icon"]}constructor(){super(),this.internal={tag:""};const t=document.querySelector("#template-env-envelope"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){if("tag"===t&&(this.tag=n),"envelope"===t){this.value=n;const t=gt(n);null!=t&&(this.label=t.label)}"icon"===t&&(this.icon=n)}get tag(){return this.internal.tag}set tag(t){this.internal.tag=t}get value(){return this.shadowRoot.querySelector("input").value}set value(t){this.shadowRoot.querySelector("input").value=t}set icon(t){this.shadowRoot.querySelector("img.env").src=`./images/envelopes/${t}.svg`}set label(t){this.shadowRoot.querySelector("label").innerHTML=t}set edited(t){const e=this.shadowRoot.querySelector("button");t?e.classList.add("edited"):e.classList.remove("edited")}set favourite(t){const e=this.shadowRoot.querySelector("button");t?e.classList.add("favourite"):e.classList.remove("favourite")}set selected(t){const e=this.shadowRoot.querySelector("button");t?e.classList.add("selected"):e.classList.remove("selected")}set onChange(t){this.shadowRoot.querySelector("input").addEventListener("change",(()=>{t(this.tag,this.value)}))}set onChanged(t){this.shadowRoot.querySelector("input").addEventListener("changed",(()=>{t(this.tag,this.value)}))}set onClick(t){this.shadowRoot.querySelector("button").addEventListener("click",(e=>{t(e)}))}update(){const t=gt(this.value);t&&(this.label=t.label)}reset(){this.value="",this.label=""}}customElements.define("snyth-envelope",_t);const te=Math.PI,ee=24,ne=24,ae=16,se=[112,112,112,24,112,112,24,112,112,24,112,112],oe=["#222222ff","#ffff00ff","#ff00ffff","#00000000","#ff0000ff","#ff0000ff","#00000000","#00ff00ff","#00ff00ff","#00000000","#0000ffff","#0000ffff"];class ie extends HTMLElement{constructor(){super(),this.internal={onChange:null,onChanged:null,state:new Map([["lfo.1",!1],["lfo.2",!1],["lfo.3",!1],["lfo.4",!1]])},this.drag={dragging:!1,interconnect:null,start:{x:0,y:0},dx:0,dy:0};const t=document.querySelector("#template-patch-panel"),e=document.createElement("link"),n=t.content,a=this.attachShadow({mode:"open"}),s=n.cloneNode(!0);e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/components.css"),a.appendChild(e),a.appendChild(s)}connectedCallback(){const t=this.shadowRoot.querySelector("canvas.overlay");t.onpointerdown=t=>this.onPointerDown(t),t.onpointerup=t=>this.onPointerUp(t)}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(t,e,n){}set onchange(t){this.internal.onChange=t}set onchanged(t){this.internal.onChanged=t}on(t,e){this.internal.state.set(t,e),this.redraw()}onPointerDown(t){if(0===t.button){const e=this.shadowRoot,n=e.querySelector("canvas.plugs"),a=e.querySelector("canvas.overlay");!function(t,e,n,a){t.preventDefault();const s=e.width,o=e.height,i=1200*t.offsetX/600,l=300*(t.offsetY-(n.offsetHeight-n.clientHeight))/150;for(const t of he)for(const e of ce)if(e.column===t.end.column&&e.row===t.end.row&&le(i,l,t,e,{width:s,height:o}))return a.start={x:i,y:l},a.dx=0,a.dy=0,a.interconnect=t,void(a.dragging=!0)}(t,n,a,this.drag),this.drag.dragging&&(a.onpointermove=t=>{!function(t,e,n,a){const s=1200*t.offsetX/600,o=300*(t.offsetY-(n.offsetHeight-n.clientHeight))/150;a.dx=s-a.start.x,a.dy=o-a.start.y}(t,0,a,this.drag),this.drawInterconnects(n,a)},a.setPointerCapture(t.pointerId))}}onPointerUp(t){const e=this.shadowRoot,n=e.querySelector("canvas.plugs"),a=e.querySelector("canvas.overlay");if(a.onpointermove=null,a.releasePointerCapture(t.pointerId),this.drag.dragging){const e=function(t,e,n,a){a.dragging=!1;const s={x:1200*t.offsetX/600,y:300*(t.offsetY-(n.offsetHeight-n.clientHeight))/150},o=e.width,i=e.height,l=64,r=(i-2*ne-3*l)/2,c=ae,h={w:104,h:53,radius:10},u=se.map(((t,e,n)=>n.slice(0,e).reduce(((t,e)=>t+e),0))),d=o-se.reduce(((t,e)=>t+e),0)-ee+(112-h.w);t:for(const t of ce){const e=d+u[t.column],n=r+t.row*l,o="label-right"===t.style?e+ae+20:e+h.w-ae-20,i=n+h.h/2,g=s.x-o,f=s.y-i;if(Math.hypot(g,f)<=c+12){for(const e of he)if(e!==a.interconnect&&e.end.row===t.row&&e.end.column===t.column)break t;a.interconnect.end.row=t.row,a.interconnect.end.column=t.column,a.interconnect.plug=t.id;break}}return a.interconnect}(t,n,a,this.drag);null!=e&&null!=this.internal.onChanged&&this.internal.onChanged(e.tag,e.plug),this.redraw()}}initialise(t){he.forEach((e=>{const n=e.tag;if(t.has(n)){const a=t.get(n);if(""===a)e.plug="",e.end.row=e.start.row,e.end.column=0;else for(const t of ce)t.id===a&&(e.plug=t.id,e.end.row=t.row,e.end.column=t.column)}})),this.redraw()}redraw(){const t=this.shadowRoot,e=t.querySelector("canvas.plugs"),n=t.querySelector("canvas.overlay");this.drawPatchBay(e),this.drawInterconnects(e,n)}drawPatchBay(t){const e=t.width,n=t.height,a=104,s=53,o=10,i=(n-2*ne-192)/2,l=t.getContext("2d");l.clearRect(0,0,e,n),l.font="20px sans-serif",l.beginPath(),l.fillStyle="#44444480",l.roundRect(ee,i,64,192+s,o),l.fill();for(const t of re){const e=ee,n=i+64*t.row,a=e+64/2;l.beginPath(),l.fillStyle=t.fill,l.strokeStyle=t.stroke,l.ellipse(a,n+s/2,ae,ae,0,0,2*te),l.fill(),l.stroke()}const r=se.map(((t,e,n)=>n.slice(0,e).reduce(((t,e)=>t+e),0))),c=e-se.reduce(((t,e)=>t+e),0)-ee+(112-a);for(const t of ce){const e=c+r[t.column],n=i+64*t.row,h=l.measureText(t.label);"blank"===t.style?(l.beginPath(),l.fillStyle="#44444480",l.roundRect(e+a-64,n,64,s,o),l.fill()):(l.beginPath(),l.fillStyle="#44444480",l.roundRect(e,n,a,s,o),l.fill());const u="label-right"===t.style?e+ae+20:e+a-ae-20,d="label-right"===t.style?ae+12:-ae-h.width-12;l.beginPath(),l.fillStyle=t.fill,l.strokeStyle=t.stroke,l.ellipse(u,n+s/2,ae,ae,0,0,2*te),l.fill(),l.stroke(),l.fillStyle=t.text,l.fillText(t.label,u+d,n+s/2+h.actualBoundingBoxAscent/2)}}drawInterconnects(t,e){const n=this.drag,a=e.getContext("2d"),s=t.width,o=t.height,i=104,l=53,r=(o-2*ne-192)/2,c=se.map(((t,e,n)=>n.slice(0,e).reduce(((t,e)=>t+e),0))),h=s-se.reduce(((t,e)=>t+e),0)-ee+(112-i);a.clearRect(0,0,e.width,e.height);const u=function(t,e,s){const o=ee+32,u=r+64*t.start.row+l/2,d="label-right"===e.style?h+c[t.end.column]+ae+20:h+c[t.end.column]+i-ae-20,g=r+64*t.end.row+l/2;let f=0,m=0;n.dragging&&t===n.interconnect&&(f=n.dx,m=n.dy);const p=a.createLinearGradient(o+1,u+1,d+2*f+1,g+2*m+1);p.addColorStop(0,`${t.colour}`),p.addColorStop(1/6,`${t.colour}`),p.addColorStop(.5,oe[t.end.column]),p.addColorStop(5/6,ue.get(e.label)),p.addColorStop(1,ue.get(e.label));const y=s?p:`${t.colour}80`;a.beginPath(),a.strokeStyle=y,a.lineWidth=30,a.lineCap="round",a.moveTo(o,u),function(t,e,n,a,s){const o=100,i=1,l=Math.cosh(i),r=Math.abs(a-e)/2,c=32,h=(a-e)/c,u=(s-n)/c,d=(a+e)/2;t.moveTo(e,n);for(let a=1;a<c;a++){const s=e+a*h,i=(s-d)/r,c=n+a*u+o*(l-Math.cosh(i));t.lineTo(s,c)}t.lineTo(a,s)}(a,o+1,u+1,d+f+1,g+m+1),a.stroke()};let d=0,g=0;for(;d<4&&g<12;){for(const t of he)if(t.end.column===g)for(const e of ce)if(e.column===t.end.column&&e.row===t.end.row){u(t,e,this.internal.state.get(t.tag)),d++;break}g++}}}function le(t,e,n,a,{width:s,height:o}){const i=104,l=53,r=(o-2*ne-192)/2,c=se.map(((t,e,n)=>n.slice(0,e).reduce(((t,e)=>t+e),0))),h=s-se.reduce(((t,e)=>t+e),0)-ee+(112-i),u=t-("label-right"===a.style?h+c[n.end.column]+ae+20:h+c[n.end.column]+i-ae-20),d=e-(r+64*n.end.row+l/2);return Math.hypot(u,d)<ae}const re=[{row:0,fill:"#ffb300c0",stroke:"#ffb30080",text:"#4eccffd0"},{row:1,fill:"#ff0000c0",stroke:"#ff000080",text:"#4eccffd0"},{row:2,fill:"#00ff00c0",stroke:"#00ff0080",text:"#4eccffd0"},{row:3,fill:"#0080fec0",stroke:"#0080fe80",text:"#4eccffd0"}],ce=[{id:"",row:0,column:0,style:"blank",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"",row:1,column:0,style:"blank",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"",row:2,column:0,style:"blank",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"",row:3,column:0,style:"blank",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"volume",row:0,column:1,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"V"},{id:"gain",row:1,column:1,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"G"},{id:"",row:2,column:1,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"",row:3,column:1,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"attack",row:0,column:2,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"A"},{id:"decay",row:1,column:2,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"D"},{id:"sustain",row:2,column:2,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"S"},{id:"release",row:3,column:2,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"R"},{id:"R.",row:0,column:4,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"R.",row:1,column:4,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"R.",row:2,column:4,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"R.a",row:3,column:4,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"a"},{id:"R.x",row:0,column:5,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"x"},{id:"R.y",row:1,column:5,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"y"},{id:"R.",row:2,column:5,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"R.b",row:3,column:5,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"b"},{id:"G.",row:0,column:7,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"G.",row:1,column:7,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"G.",row:2,column:7,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"G.a",row:3,column:7,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"a"},{id:"G.x",row:0,column:8,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"x"},{id:"G.y",row:1,column:8,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"y"},{id:"G.",row:2,column:8,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"G.b",row:3,column:8,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"b"},{id:"B.",row:0,column:10,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"B.",row:1,column:10,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"B.",row:2,column:10,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"B.a",row:3,column:10,style:"label-left",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"a"},{id:"B.x",row:0,column:11,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"x"},{id:"B.y",row:1,column:11,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"y"},{id:"B.",row:2,column:11,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:""},{id:"B.b",row:3,column:11,style:"label-right",fill:"#808080c0",stroke:"#808080ff",text:"#4eccffd0",label:"b"}],he=[{tag:"lfo.1",plug:"volume",start:{row:0},end:{row:0,column:1},colour:"#cc8f00"},{tag:"lfo.2",plug:"gain",start:{row:1},end:{row:1,column:1},colour:"#cc0000"},{tag:"lfo.3",plug:null,start:{row:2},end:{row:2,column:0},colour:"#2f9c02"},{tag:"lfo.4",plug:null,start:{row:3},end:{row:3,column:0},colour:"#0044cb"}],ue=new Map([["","#444444ff"],["V","#9c27b0ff"],["G","#e91e63ff"],["A","#ffeb3bff"],["D","#00bcd4ff"],["S","#009688ff"],["R","#795548ff"],["","#3f51b5ff"],["","#673ab7ff"],["","#ff00ffff"],["a","#ffd700ff"],["x","#40e0d0ff"],["y","#dda0ddff"],["","#ff7f50ff"],["b","#808000ff"]]);customElements.define("snyth-patch-panel",ie);export{n as Checkbox,Mt as ControlSet,Ct as ControlsEnvelope,Ot as ENVEditor,_t as ENVEnvelope,Yt as FFT,_ as Gain,Pt as GenFN,r as Knob,v as KnobF,x as KnobLR,m as KnobM,u as KnobS,kt as Load,$ as MinMax,ie as PatchPanel,I as Picker,St as Play,s as ProgressBar,t as PushButton,E as RangeFloat,R as RangeMS,qt as Recording,S as Shape,a as Slot,e as ToggleButton,O as Volume,At as Waveform,W as Worklets,F as Zoom};
