<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>transcriptaze - W2P</title>
    <link rel="icon"       href="images/favicon.png">
    <link rel="stylesheet" href="css/transcriptaze.css" type="text/css">
    <link rel="stylesheet" href="css/W2P.css" type="text/css">
    <script src="./javascript/wasm_exec.js"></script>
    <script>
      var onComplete

      document.addEventListener('readystatechange', event => {
        switch (event.target.readyState) {
          case 'complete':           
              const go = new Go()
              WebAssembly
                .instantiateStreaming(fetch("./wasm/W2P.wasm"), go.importObject)
                .then((result) => {
                  go.run(result.instance)
                })

              onComplete('document')
              break;
        }
      })
    </script>
  </head>

  <body> 
    <div id="content">

      <!-- HEADER -->
      <header>
        <img id="logo" src="images/logo.png" />
        
        <div id="banner">
          <div id="nav">
           <a href="./T2B.html">T2B</a>
           <a class="active" href=".">W2P</a>
          </div>
          <div>
           <p id="blurb">
            In-browser utility to create a downloadable PNG waveform from an audio file,<br/>
            because sometimes you just <em>don't</em> want to go read the <a href="http://sox.sourceforge.net/" target="blank">SoX</a> manual.
           </p>
          </div>
        </div>

        <div id="github">          
          <a href="https://github.com/transcriptaze" target="_blank">
            <span><img src="images/github-brands.svg" draggable="false"/>GitHub</span>
          </a>
        </div>
      </header>

      <!-- NAV -->
      <nav>
      </nav>

      <!-- MAIN -->
      <main>
        <div>
          <div id="container">
            <div id="spectrogram" class="panel" ondrop="onDrop(event)"  ondragover="onDragOver(event)">
              <div id="picker" class="picker">
                <input id="file" type="file" accept="audio/*" onchange="onPicked(event)" style="display:none;" />
                <img onclick="return onPick(event)" src="../images/audio.png" />
              </div>
              <div>
                <canvas id="canvas" width="640" height="390">
                </canvas>
              </div>
            </div>

            <div id="controls" class="panel">
              CONTROLS
            </div>

          </div>
        </div>
      </main>

      <!-- FOOTER -->
      <footer>
       YouTube (and possibly Github) seem to unavoidably add cookies to this page. Also, your settings and history, 
       such as they are, are kept in browser local storage.
      </footer>
    </div>
  </body>

  <!-- SCRIPTS -->
 
  <script type="module">
    import { onDrop, onDragOver, onPick, onPicked } from './javascript/W2P.js'

    window.onDrop = onDrop
    window.onDragOver = onDragOver
    window.onPick = onPick
    window.onPicked = onPicked
  </script>

  <script type="text/javascript">
    // Defer doing anything useful until WASM is loaded and everything is ready
    // (modules are loaded after scripts, Github pages are static, etc)
    const complete = new Promise((resolve) => { onComplete = resolve })

    Promise.all([complete]).then((v) => {
      console.log("'k, ready at last")
    })
  </script>

</html>
