<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>transcriptaze - W2P</title>
    <link rel="icon"       href="images/favicon.png">
    <link rel="stylesheet" href="css/transcriptaze.css" type="text/css">
    <link rel="stylesheet" href="css/W2P.css" type="text/css">
    <script src="./javascript/wasm_exec.js"></script>
    <script>
      var onComplete

      document.addEventListener('readystatechange', event => {
        switch (event.target.readyState) {
          case 'complete':           
              const go = new Go()
              WebAssembly
                .instantiateStreaming(fetch("./wasm/W2P.wasm"), go.importObject)
                .then((result) => {
                  go.run(result.instance)
                })

              onComplete('document')
              break;
        }
      })
    </script>
  </head>

  <body> 
    <div id="content">

      <!-- HEADER -->
      <header>
        <img id="logo" src="images/logo.png" />
        
        <div id="banner">
          <div id="nav">
           <a href="./T2B.html">T2B</a>
           <a class="active" href=".">W2P</a>
          </div>
          <div>
           <p id="blurb">
            In-browser utility to create a downloadable PNG waveform from an audio file,<br/>
            because sometimes you just don't want to go read the <a href="http://sox.sourceforge.net/" target="blank">SoX</a> manual.
           </p>
          </div>
        </div>

        <div id="github">          
          <a href="https://github.com/transcriptaze" target="_blank">
            <span><img src="images/github-brands.svg" draggable="false"/>GitHub</span>
          </a>
        </div>
      </header>

      <!-- NAV -->
      <nav>
      </nav>

      <!-- MAIN -->
      <main>
        <div>
          <div id="container">
            <div id="wave" class="panel" ondrop="onDrop(event)"  ondragover="onDragOver(event)">
              <div id="picker" class="picker">
                <input id="file" type="file" accept="audio/*" onchange="onPicked(event)" style="display: none;" />
                <img onclick="return onPick(event)" src="../images/audio.png" />
                <div id="message">&nbsp;</div>
              </div>
              <div>
                <img id="png" onclick="zoom(event)" />                
              </div>
            </div>

            <div id="sizes" class="panel">
              <div class="size">
                <input id="sz0" type="radio" name="size" class="size" value="645x392" onchange="onSize(event)" checked />
                <label for="sz0">645 x 392</label>
              </div>
              <div class="size">
                <input id="sz1" type="radio" name="size" class="size" value="640x480" onchange="onSize(event)" />
                <label for="sz1">640 x 480</label>
              </div>
              <div class="size">
                <input id="sz2" type="radio" name="size" class="size" value="800x600" onchange="onSize(event)" />
                <label for="sz2">800 x 600</label>
              </div>
              <div class="size">
                <input id="sz3" type="radio" name="size" class="size" value="1024x800" onchange="onSize(event)" />
                <label for="sz3">1024 x 800</label>
              </div>
              <div class="size">
                <input id="sz4" type="radio" name="size" class="size" value="1280x800" onchange="onSize(event)" />
                <label for="sz4">1280 x 800</label>
              </div>
              <div class="size">
                <input id="sz5" type="radio" name="size" class="size" value="2048x1640" onchange="onSize(event)" />
                <label for="sz5">2048 x 1640</label>
              </div>
              <div class="size">
                <input id="szx" type="radio" name="size" class="size" value="custom" onchange="onSize(event)" />
                <label for="szx">CUSTOM</label>
              </div>
              <div class="size">
                <input id="custom" type="text" value="" placeholder="480 x 292" />
              </div>
            </div>

            <div id="controls" class="panel">
                <input type="checkbox" checked>grid</button>
            </div>

            <!-- ENLARGED PNG VIEW -->
            <dialog id="zoom">
              <img id="zoomed" draggable="false"/>                
              <div>
              <form method="dialog">
                <menu>
                  <button id="close" value="cancel">X</button>
                </menu>
              </form>
              </div>
            </dialog>

          </div>
        </div>
      </main>

      <!-- FOOTER -->
      <footer>
       Somebody (possibly Github) seems to unavoidably add cookies to this page. Also, your settings and history, 
       such as they are, are kept in browser local storage.
      </footer>
    </div>
  </body>

  <!-- SCRIPTS -->
 
  <script type="module">
    import { initialise,
             onDrop, onDragOver, onPick, onPicked, onSize 
          } from './javascript/W2P.js'

    window.onDrop = onDrop
    window.onDragOver = onDragOver
    window.onPick = onPick
    window.onPicked = onPicked
    window.onSize = onSize

    initialise()
  </script>

  <script type="text/javascript">
    // Defer doing anything useful until WASM is loaded and everything is ready
    // (modules are loaded after scripts, Github pages are static, etc)
    const complete = new Promise((resolve) => { onComplete = resolve })

    Promise.all([complete]).then((v) => {
      console.log("'k, ready at last")
    })
  </script>

  <script type="text/javascript">
    function zoom(event) {
       document.getElementById('zoom').showModal()
    }
  </script>

</html>
